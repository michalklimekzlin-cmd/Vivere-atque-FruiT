<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Vivere atque FruiT • 3D rámeček</title>

    <style>
      :root {
        --barva-pozadi: #020308;
        --barva-linky: #14151c;
        --barva-ramecek-hrana: #fdfdfd; /* bílá kostra */
        --barva-ramecek-seda: #6a707a; /* šedé plochy */
        --barva-ramecek-cervena: #c93b3b; /* červený střed */
        --barva-text: #f5f5f5;
        --barva-text-slabsi: #b2b2c7;
        --font-zaklad: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: radial-gradient(circle at top, #050818, var(--barva-pozadi));
        color: var(--barva-text);
        font-family: var(--font-zaklad);
      }

      .vrstva-koren {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: stretch;
        justify-content: stretch;
      }

      canvas#platno-ramecek {
        width: 100%;
        height: 100%;
        display: block;
      }

      .vrstva-horni-panel {
        position: fixed;
        inset: 0 auto auto 0;
        padding: 10px 14px;
        display: flex;
        flex-direction: column;
        gap: 4px;
        pointer-events: none;
      }

      .znacka-aplikace {
        font-size: 14px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--barva-text-slabsi);
      }

      .radek-stav {
        display: flex;
        gap: 10px;
        align-items: center;
        font-size: 12px;
        color: var(--barva-text-slabsi);
      }

      .odznak-zivy {
        padding: 2px 6px;
        border-radius: 999px;
        background: rgba(248, 103, 166, 0.14);
        border: 1px solid rgba(248, 103, 166, 0.8);
        color: #ffd7f0;
        font-size: 11px;
      }

      .vrstva-spodni-panel {
        position: fixed;
        inset: auto 0 0 0;
        padding: 10px 16px 14px;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.65),
          rgba(0, 0, 0, 0)
        );
        display: flex;
        flex-direction: column;
        gap: 6px;
        pointer-events: none;
      }

      .radek-informace-ramecek {
        font-size: 11px;
        color: var(--barva-text-slabsi);
      }

      .radek-sloty {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
      }

      .odznak-slot {
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(150, 150, 190, 0.6);
        background: rgba(10, 10, 30, 0.7);
        font-size: 11px;
        color: var(--barva-text-slabsi);
        pointer-events: auto;
        user-select: none;
      }

      .odznak-slot--aktivni {
        border-color: var(--barva-ramecek-cervena);
        color: #ffe9b0;
        box-shadow: 0 0 8px rgba(201, 59, 59, 0.7);
      }

      .odznak-slot-klic {
        opacity: 0.7;
      }
    </style>
  </head>
  <body>
    <div class="vrstva-koren">
      <canvas id="platno-ramecek"></canvas>
    </div>

    <!-- horní info vrstva \\{*(°•.)(.•°)*}// -->
    <div class="vrstva-horni-panel">
      <div class="znacka-aplikace">VIVERE ATQUE FRUIT • 3D RÁMEČEK</div>
      <div class="radek-stav">
        <span class="odznak-zivy">živý panel • 3D kostra</span>
        <span id="stav-slot-aktivni">aktivní slot: střed 1</span>
        <span id="stav-lupa">lupa: střed</span>
      </div>
    </div>

    <!-- spodní info vrstva: připínání modulů -->
    <div class="vrstva-spodni-panel">
      <div class="radek-informace-ramecek">
        3D rámeček: bílá kostra, šedé 2D plochy (vršek a pravý bok), červený
        pohyblivý střed se 4 sloty. Ovládání: otočení tahem prstu, přiblížení
        (pinch / kolečko), volba středu dole.
      </div>
      <div class="radek-sloty" id="panel-sloty">
        <div class="odznak-slot odznak-slot--aktivni" data-slot="0">
          Střed 1 • písmenka
        </div>
        <div class="odznak-slot" data-slot="1">Střed 2 • vlevo</div>
        <div class="odznak-slot" data-slot="2">Střed 3 • vpravo</div>
        <div class="odznak-slot" data-slot="3">Střed 4 • vzadu</div>
        <div class="odznak-slot odznak-slot-klic">≋ budoucí modul: svět</div>
        <div class="odznak-slot odznak-slot-klic">≋ budoucí modul: AI</div>
        <div class="odznak-slot odznak-slot-klic">≋ budoucí modul: glyph</div>
        <div class="odznak-slot odznak-slot-klic">≋ budoucí modul: VaFiT</div>
      </div>
    </div>

    <!-- Three.js – jednoduchý, stabilní build -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

    <script>
      "use strict";

      // …iT… datový model rámečku \\{*(°•.)(.•°)*}//

      class VkladaciStred {
        constructor(id, popis, typObsahu = "pismenka") {
          this.id = id;
          this.popis = popis;
          this.typObsahu = typObsahu;
          this.obsah = null;
        }
      }

      class ZakladniRamecek {
        constructor() {
          this.rezimLupy = "stred"; // "stred" | "cely"
          this.aktivniStredIndex = 0;

          this.pritahovaciHak = {
            aktivni: true,
            dosah: 0.25,
            sila: 0.12,
          };

          this.stredy = [
            new VkladaciStred("stred-1", "Střed 1 • písmenka", "pismenka"),
            new VkladaciStred("stred-2", "Střed 2 • vlevo", "volny"),
            new VkladaciStred("stred-3", "Střed 3 • vpravo", "volny"),
            new VkladaciStred("stred-4", "Střed 4 • vzadu", "volny"),
          ];
        }

        prepniAktivniStred(index) {
          if (index < 0 || index >= this.stredy.length) return;
          this.aktivniStredIndex = index;
        }

        prepniRezimLupy() {
          this.rezimLupy = this.rezimLupy === "stred" ? "cely" : "stred";
        }
      }

      // ────────────────────────────────────────────────
      // 3D SCÉNA – jednoduchá, stabilní
      // ────────────────────────────────────────────────

      const platno = document.getElementById("platno-ramecek");

      const scena = new THREE.Scene();
      scena.background = new THREE.Color(0x020308);

      const kamera = new THREE.PerspectiveCamera(
        45,
        window.innerWidth / window.innerHeight,
        0.1,
        50
      );
      kamera.position.set(2.4, 1.6, 3.2);

      const renderer = new THREE.WebGLRenderer({
        canvas: platno,
        antialias: true,
      });
      renderer.setPixelRatio(window.devicePixelRatio || 1);
      renderer.setSize(window.innerWidth, window.innerHeight);

      const skupinaRamecek = new THREE.Group();
      scena.add(skupinaRamecek);

      const sirka = 1.8;
      const vyska = 1.2;
      const hloubka = 1.2;

      function cssBarva(hexPromenna) {
        const styl = getComputedStyle(document.documentElement);
        const hodnota = styl.getPropertyValue(hexPromenna).trim() || "#ffffff";
        return new THREE.Color(hodnota);
      }

      // bílá kostra – hrany kvádru
      const hranyGeom = new THREE.BoxGeometry(sirka, vyska, hloubka);
      const hranyEdg = new THREE.EdgesGeometry(hranyGeom);
      const hranyMat = new THREE.LineBasicMaterial({
        color: cssBarva("--barva-ramecek-hrana"),
      });
      const hrany = new THREE.LineSegments(hranyEdg, hranyMat);
      skupinaRamecek.add(hrany);

      // šedý vršek (2D plocha)
      const matSedy = new THREE.MeshBasicMaterial({
        color: cssBarva("--barva-ramecek-seda"),
        transparent: true,
        opacity: 0.85,
        side: THREE.DoubleSide,
      });

      const horniGeom = new THREE.PlaneGeometry(sirka, hloubka);
      const horniPlocha = new THREE.Mesh(horniGeom, matSedy);
      horniPlocha.rotation.x = -Math.PI / 2;
      horniPlocha.position.set(0, vyska / 2, 0);
      skupinaRamecek.add(horniPlocha);

      // šedý pravý bok
      const bocniGeom = new THREE.PlaneGeometry(hloubka, vyska);
      const pravyBok = new THREE.Mesh(bocniGeom, matSedy);
      pravyBok.rotation.y = -Math.PI / 2;
      pravyBok.position.set(sirka / 2, 0, 0);
      skupinaRamecek.add(pravyBok);

      // čelní "deska" – bílý kvádr s dírou simulujeme jako rám + vnitřní červený blok
      const ramecek = new ZakladniRamecek();

      const stredGeom = new THREE.BoxGeometry(
        sirka * 0.6,
        vyska * 0.6,
        hloubka * 0.6
      );
      const stredMat = new THREE.MeshBasicMaterial({
        color: cssBarva("--barva-ramecek-cervena"),
        transparent: true,
        opacity: 0.9,
      });
      const stredMesh = new THREE.Mesh(stredGeom, stredMat);
      stredMesh.position.set(0, 0, -0.2);
      skupinaRamecek.add(stredMesh);

      // 4 cílové pozice středu
      const cilovePoziceStredu = [
        new THREE.Vector3(0, 0, -0.2), // střed
        new THREE.Vector3(-0.35, 0, -0.15), // vlevo
        new THREE.Vector3(0.35, 0, -0.15), // vpravo
        new THREE.Vector3(0, 0, -0.55), // vzadu
      ];
      let cilovaPoziceStredu = cilovePoziceStredu[0].clone();

      // cílová vzdálenost kamery (lupa)
      let cilovaVzdalenost = 3.0;

      // ────────────────────────────────────────────────
      // Ovládání slotů + lupa
      // ────────────────────────────────────────────────

      const panelSloty = document.getElementById("panel-sloty");
      const textAktivni = document.getElementById("stav-slot-aktivni");
      const textLupa = document.getElementById("stav-lupa");

      panelSloty.addEventListener("click", (udalost) => {
        const cil = udalost.target.closest(".odznak-slot");
        if (!cil) return;
        const index = Number(cil.dataset.slot);
        if (Number.isNaN(index)) return;

        ramecek.prepniAktivniStred(index);
        cilovaPoziceStredu = cilovePoziceStredu[index].clone();
        aktualizovatSlotOdznaky();
      });

      function aktualizovatSlotOdznaky() {
        const odznaky = panelSloty.querySelectorAll(".odznak-slot[data-slot]");
        odznaky.forEach((el) => {
          const index = Number(el.dataset.slot);
          if (index === ramecek.aktivniStredIndex) {
            el.classList.add("odznak-slot--aktivni");
          } else {
            el.classList.remove("odznak-slot--aktivni");
          }
        });

        const aktivniStred = ramecek.stredy[ramecek.aktivniStredIndex];
        textAktivni.textContent = "aktivní slot: " + aktivniStred.popis;
        textLupa.textContent =
          "lupa: " + (ramecek.rezimLupy === "stred" ? "střed" : "celý rámeček");
      }

      aktualizovatSlotOdznaky();

      platno.addEventListener("click", () => {
        ramecek.prepniRezimLupy();
        cilovaVzdalenost = ramecek.rezimLupy === "stred" ? 2.4 : 3.4;
        aktualizovatSlotOdznaky();
      });

      // ────────────────────────────────────────────────
      // Ovládání prstem / myší – rotace skupiny
      // ────────────────────────────────────────────────

      let tahAktivni = false;
      let posledniX = 0;
      let posledniY = 0;

      platno.addEventListener("pointerdown", (e) => {
        tahAktivni = true;
        posledniX = e.clientX;
        posledniY = e.clientY;
        platno.setPointerCapture(e.pointerId);
      });

      platno.addEventListener("pointermove", (e) => {
        if (!tahAktivni) return;
        const dx = e.clientX - posledniX;
        const dy = e.clientY - posledniY;
        posledniX = e.clientX;
        posledniY = e.clientY;

        const rychlost = 0.005;
        skupinaRamecek.rotation.y += dx * rychlost;
        skupinaRamecek.rotation.x += dy * rychlost;
      });

      platno.addEventListener("pointerup", (e) => {
        tahAktivni = false;
        platno.releasePointerCapture(e.pointerId);
      });

      // zoom kolečkem (desktop) – na iPadu bude pinch systémový
      window.addEventListener(
        "wheel",
        (e) => {
          const delta = e.deltaY > 0 ? 0.2 : -0.2;
          cilovaVzdalenost = THREE.MathUtils.clamp(
            cilovaVzdalenost + delta,
            2.0,
            4.5
          );
        },
        { passive: true }
      );

      // ────────────────────────────────────────────────
      // Resize
      // ────────────────────────────────────────────────

      window.addEventListener("resize", () => {
        const w = window.innerWidth;
        const h = window.innerHeight;
        kamera.aspect = w / h;
        kamera.updateProjectionMatrix();
        renderer.setPixelRatio(window.devicePixelRatio || 1);
        renderer.setSize(w, h);
      });

      // ────────────────────────────────────────────────
      // Animace – kamera + pohyblivý střed
      // ────────────────────────────────────────────────

      function animace() {
        requestAnimationFrame(animace);

        // plynulé přibližování kamery
        const sm = kamera.position.length();
        const nove = THREE.MathUtils.lerp(sm, cilovaVzdalenost, 0.08);
        kamera.position.normalize().multiplyScalar(nove);
        kamera.lookAt(0, 0, 0);

        // přitažení středu (magnet)
        stredMesh.position.lerp(cilovaPoziceStredu, 0.12);

        renderer.render(scena, kamera);
      }

      animace();
    </script>
  </body>
</html>
