<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lilie â€¢ pÅ™Ã­roda</title>
  <style>
    :root {
      --bg: #05070b;
      --panel: rgba(6,10,14,.92);
      --line: rgba(255,255,255,.04);
      --accent: #61d6ff;
    }
    body {
      margin: 0;
      height: 100vh;
      background: var(--bg);
      color: #eef;
      font-family: system-ui,-apple-system,sans-serif;
      overflow: hidden;
      position: relative;
    }

    /* ÄtyÅ™i rohy */
    .lilie-btn {
      position: fixed;
      background: rgba(3,5,7,.2);
      border: 1px solid rgba(255,255,255,.03);
      border-radius: .7rem;
      padding: 6px 10px;
      min-width: 40px;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(2px);
      z-index: 10;
    }
    #btn-book { top: 12px; left: 12px; }
    #btn-gold { top: 12px; right: 12px; }
    #btn-car  { bottom: 12px; left: 12px; }
    #btn-help { bottom: 12px; right: 12px; }

    /* stÅ™ed â€“ Lilie */
    #lilie-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      width: 190px;
      height: 190px;
      border-radius: 50%;
      background: radial-gradient(circle,#ffffff0f 0%, #000 75%);
      border: 1px solid rgba(255,255,255,.03);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      pointer-events: none;
    }
    #lilie-center span {
      font-size: 20px;
      letter-spacing: .03em;
    }

    /* panely */
    .lilie-panel {
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: min(95vw, 340px);
      max-height: 80vh;
      background: var(--panel);
      border: 1px solid rgba(255,255,255,.02);
      border-radius: 1rem;
      padding: 12px 14px;
      overflow-y: auto;
      display: none;
      z-index: 20;
    }
    .lilie-panel h2 {
      margin-top: 0;
      font-size: 16px;
    }
    .line {
      height: 1px;
      background: var(--line);
      margin: 8px 0 10px;
    }
    button.primary {
      background: linear-gradient(135deg,#21c1ff,#0a87b9);
      border: none;
      border-radius: .5rem;
      padding: 4px 10px;
      color: #011;
      font-weight: 600;
      cursor: pointer;
    }
    input, textarea {
      width: 100%;
      background: rgba(1,1,1,.2);
      border: 1px solid rgba(255,255,255,.03);
      border-radius: .5rem;
      color: #fff;
      padding: 5px 6px;
      margin-bottom: 6px;
    }
  </style>
</head>
<body>

  <!-- rohy -->
  <div id="btn-book" class="lilie-btn" title="Kniha ğŸ“–">ğŸ“–</div>
  <div id="btn-gold" class="lilie-btn" title="ZlaÅ¥Ã¡ky ğŸ’°">ğŸ’°</div>
  <div id="btn-car"  class="lilie-btn" title="Karavan / cesta">ğŸš</div>
  <div id="btn-help" class="lilie-btn" title="NÃ¡pady / pomoc">â“</div>

  <!-- stÅ™ed -->
  <div id="lilie-center">
    <span>Lilie ğŸŒ¸</span>
  </div>

  <!-- panel: Kniha -->
  <div id="panel-book" class="lilie-panel">
    <h2>Kniha / ZÃ¡pisnÃ­k</h2>
    <p>Sem patÅ™Ã­ vÄ›ci z pÅ™Ã­rody:</p>
    <div class="line"></div>
    <label>ğŸ“· Fotka</label>
    <input id="book-photo" type="file" accept="image/*" capture="environment">
    <label>ğŸ“ PoznÃ¡mka</label>
    <input id="book-note" type="text" placeholder="napÅ™. dub u potoka">
    <button id="book-save" class="primary">UloÅ¾it zÃ¡znam</button>
    <div class="line"></div>
    <h3>PoslednÃ­ zÃ¡pisy</h3>
    <div id="book-list" style="font-size:12px;opacity:.7;"></div>
  </div>

  <!-- panel: ZlaÅ¥Ã¡ky -->
  <div id="panel-gold" class="lilie-panel">
    <h2>OdmÄ›ny / Ãºkoly ğŸ’°</h2>
    <p>Stav: <b id="gold-amount">0</b> KÄ</p>
    <div class="line"></div>
    <ul id="gold-tasks" style="list-style:none; padding-left:0; font-size:13px;"></ul>
  </div>

  <!-- panel: Karavan -->
  <div id="panel-car" class="lilie-panel">
    <h2>Karavan / Cesta ğŸš</h2>
    <p>GPS + SOS + mini mapa (pozor: offline)</p>
    <div class="line"></div>
    <button id="gps-start" class="primary">ZaÄÃ­t sledovat</button>
    <button id="gps-stop" class="primary" style="margin-left:4px;">Zastavit</button>
    <p id="gps-status" style="font-size:12px;opacity:.7;margin-top:6px;">GPS: ÄekÃ¡mâ€¦</p>
    <div class="line"></div>
    <label>SOS zprÃ¡va</label>
    <textarea id="sos-msg" rows="2" placeholder="PopiÅ¡ situaci..."></textarea>
    <button id="sos-save" class="primary">UloÅ¾it SOS</button>
  </div>

  <!-- panel: OtaznÃ­k -->
  <div id="panel-help" class="lilie-panel">
    <h2>NÃ¡pady pro vÃ½vojÃ¡Å™e â“</h2>
    <p>NapiÅ¡, co bys chtÄ›l v Lilii doprogramovat.</p>
    <textarea id="idea" rows="3" placeholder="NapÅ™. pÅ™idat zvuk ptÃ¡kÅ¯, rychlÃ½ SOS, QR odmÄ›nu..."></textarea>
    <button id="idea-save" class="primary">UloÅ¾it nÃ¡pad</button>
    <div class="line"></div>
    <small style="opacity:.6;">NÃ¡pad se uloÅ¾Ã­ do telefonu, hlavnÃ­ VAFT si ho pak mÅ¯Å¾e naÄÃ­st.</small>
  </div>

  <script>
    // spoleÄnÃ½ ÃºloÅ¾nÃ½ prostor
    const LS_GOLD = 'VAFT_GOLD';
    const LS_BOOK = 'VAFT_LILIE_LOG';
    const LS_IDEA = 'VAFT_LILIE_NOTES';

    // otevÅ™enÃ­/zavÅ™enÃ­ panelÅ¯
    const panels = {
      book: document.getElementById('panel-book'),
      gold: document.getElementById('panel-gold'),
      car:  document.getElementById('panel-car'),
      help: document.getElementById('panel-help')
    };
    function showPanel(name) {
      Object.values(panels).forEach(p => p.style.display = 'none');
      panels[name].style.display = 'block';
    }
    document.getElementById('btn-book').onclick = () => showPanel('book');
    document.getElementById('btn-gold').onclick = () => {
      renderTasks();
      showPanel('gold');
    };
    document.getElementById('btn-car').onclick  = () => showPanel('car');
    document.getElementById('btn-help').onclick = () => {
      const saved = localStorage.getItem(LS_IDEA);
      if (saved) document.getElementById('idea').value = saved;
      showPanel('help');
    };

    // zlaÅ¥Ã¡ky
    let gold = parseInt(localStorage.getItem(LS_GOLD) || '0', 10);
    const goldAmountEl = document.getElementById('gold-amount');
    goldAmountEl.textContent = gold;

    const tasks = [
      { id: 't1', title: 'VyfoÅ¥ strom i s kmenem', reward: 50, keyword: 'strom' },
      { id: 't2', title: 'VyfoÅ¥ vodu / Å™eku / potok', reward: 100, keyword: 'Å™eka' },
      { id: 't3', title: 'VyfoÅ¥ mech', reward: 40, keyword: 'mech' },
    ];
    function renderTasks() {
      const ul = document.getElementById('gold-tasks');
      ul.innerHTML = '';
      tasks.forEach(t => {
        const li = document.createElement('li');
        li.textContent = 'â€¢ ' + t.title + ' (+' + t.reward + ' KÄ)';
        ul.appendChild(li);
      });
    }
    // uloÅ¾it zÃ¡znam z knihy a zkusit splnit Ãºkol
    document.getElementById('book-save').onclick = () => {
      const note = document.getElementById('book-note').value.trim().toLowerCase();
      const file = document.getElementById('book-photo').files[0];
      const list = JSON.parse(localStorage.getItem(LS_BOOK) || '[]');

      const saveEntry = (imgData) => {
        const entry = { t: Date.now(), note, img: imgData || null };
        list.push(entry);
        localStorage.setItem(LS_BOOK, JSON.stringify(list));
        renderBookList(list);

        // odmÄ›na
        let rewarded = false;
        tasks.forEach(t => {
          if (!rewarded && note.includes(t.keyword)) {
            gold += t.reward;
            localStorage.setItem(LS_GOLD, gold);
            goldAmountEl.textContent = gold;
            rewarded = true;
          }
        });
        alert(rewarded ? 'Ãškol splnÄ›n, odmÄ›na pÅ™ipsÃ¡na ğŸ’°' : 'ZapsÃ¡no ğŸ“–');
        document.getElementById('book-note').value = '';
        document.getElementById('book-photo').value = '';
      };

      if (file) {
        const reader = new FileReader();
        reader.onload = e => saveEntry(e.target.result);
        reader.readAsDataURL(file);
      } else {
        saveEntry(null);
      }
    };

    function renderBookList(list) {
      const box = document.getElementById('book-list');
      box.innerHTML = '';
      list.slice(-5).reverse().forEach(e => {
        const d = new Date(e.t).toLocaleString();
        const p = document.createElement('p');
        p.textContent = d + ' â€“ ' + (e.note || '[bez pozn.]');
        box.appendChild(p);
      });
    }
    // naÄti pÅ™i startu
    const savedBook = JSON.parse(localStorage.getItem(LS_BOOK) || '[]');
    renderBookList(savedBook);

    // karavan â€“ GPS + SOS
    let gpsWatch = null;
    document.getElementById('gps-start').onclick = () => {
      if (!navigator.geolocation) { alert('GPS nenÃ­ dostupnÃ¡'); return; }
      gpsWatch = navigator.geolocation.watchPosition(pos => {
        document.getElementById('gps-status').textContent =
          'GPS: ' + pos.coords.latitude.toFixed(5) + ', ' + pos.coords.longitude.toFixed(5);
        // mÅ¯Å¾eÅ¡ uloÅ¾it do localStorage pro hlavnÃ­ hru
        localStorage.setItem('VAFT_LILIE_LAST_GPS', JSON.stringify({
          lat: pos.coords.latitude,
          lon: pos.coords.longitude,
          t: Date.now()
        }));
      });
    };
    document.getElementById('gps-stop').onclick = () => {
      if (gpsWatch) navigator.geolocation.clearWatch(gpsWatch);
      document.getElementById('gps-status').textContent = 'GPS: zastaveno';
    };
    document.getElementById('sos-save').onclick = () => {
      const msg = document.getElementById('sos-msg').value.trim();
      const old = JSON.parse(localStorage.getItem('VAFT_LILIE_SOS') || '[]');
      old.push({ msg: msg || '[SOS]', t: Date.now() });
      localStorage.setItem('VAFT_LILIE_SOS', JSON.stringify(old));
      document.getElementById('sos-msg').value = '';
      alert('SOS uloÅ¾eno (veÅ™ejnÃ©).');
    };

    // otaznÃ­k â€“ nÃ¡pady
    document.getElementById('idea-save').onclick = () => {
      const txt = document.getElementById('idea').value.trim();
      localStorage.setItem(LS_IDEA, txt);
      alert('NÃ¡pad uloÅ¾en ğŸ¥°');
    };

    // po naÄtenÃ­ dej svÄ›tu vÄ›dÄ›t, Å¾e Lilie Å¾ije
    localStorage.setItem('VAFT_PULSE', Date.now().toString());
  </script>
</body>
</html>
