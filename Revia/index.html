<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Revia ‚Ä¢ Vivere atque FruiT</title>

    <!-- Styl Revie -->
    <link rel="stylesheet" href="./revia.css?v=0.74" />

    <!-- Jemn√© nastaven√≠ pozad√≠ (m≈Ø≈æe≈° klidnƒõ nechat) -->
    <style>
      body {
        background-size: auto 70vh;
        background-position: center 18vh;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-color: #000;
      }
      @media (max-height: 820px) {
        body {
          background-size: auto 68vh;
          background-position: center 20vh;
        }
      }
      @media (min-height: 900px) {
        body {
          background-size: auto 78vh;
          background-position: center 15vh;
        }
      }
      @media (max-width: 480px) {
        body {
          background-size: auto 88vh;
          background-position: center 0;
        }
      }
    </style>
  </head>

  <body>
    <!-- Hlavn√≠ wrapper Revie -->
    <div
      class="revia-main"
      id="reviaMain"
      data-mode="angel"
      data-control="ai"
    >
      <!-- horn√≠ li≈°ta -->
      <div class="revia-topbar">
        <!-- k≈ô√≠dlo = z√°pisn√≠k -->
        <button
          class="revia-wing"
          id="revWing"
          type="button"
          aria-label="otev≈ô√≠t z√°pisn√≠k"
        ></button>

        <div class="revia-title">Revia</div>
        <div class="revia-state" id="revState">AI: hl√≠d√°m svƒõt</div>
      </div>

      <!-- z√°pisn√≠k -->
      <div class="revia-notes" id="revNotes">
        <div class="notes-head">
          <span>‚úß K≈ô√≠dlo / z√°pis</span>
          <button id="notesClose" type="button">√ó</button>
        </div>
        <textarea
          id="notesText"
          placeholder="Charakter, √∫koly, komu se uk√°≈æe‚Ä¶"
        ></textarea>
        <p class="notes-foot">Ukl√°d√° se jen do tohoto za≈ô√≠zen√≠.</p>
      </div>

      <!-- m≈ô√≠≈æka slot≈Ø (dovednosti) -->
      <div class="revia-card">
        <!-- SLOT 1: port√°l do Centra (hlavn√≠ index) -->
        <button
          class="revia-slot active"
          id="slotPortal"
          type="button"
          aria-label="Otev≈ô√≠t Vivere atque FruiT ‚Ä¢ Revia &amp; Centrum"
        >
          <span class="revia-glyph" id="slotPortalGlyph">Ÿã&‚Äô„Äç</span>
        </button>

        <!-- SLOT 2: Revia chat -->
        <button
          class="revia-slot"
          id="slotChat"
          type="button"
          aria-label="Otev≈ô√≠t Revia chat"
        >
          <span class="revia-glyph">üí¨</span>
        </button>

        <!-- SLOT 3: P≈ôepnout AI / Human (bez textu) -->
        <button
          class="revia-slot"
          id="slotControl"
          type="button"
          aria-label="P≈ôepnout ≈ô√≠zen√≠ mezi AI a Human"
        ></button>

        <!-- SLOT 4: Andƒõl ‚ù§Ô∏è / ƒé√°bel ‚òÜ ‚Äì p≈ôep√≠n√° m√≥d svƒõta -->
        <button
          class="revia-slot"
          id="slotMode"
          type="button"
          aria-label="P≈ôepnout Revia m√≥d andƒõl / ƒè√°bel"
        >
          <span class="revia-glyph" id="slotModeGlyph">„Äåƒ™‚Äô‚ô°</span>
        </button>

        <!-- SLOT 5: Rezerva (zat√≠m info) -->
        <button
          class="revia-slot"
          id="slotWorld"
          type="button"
          aria-label="Budouc√≠ svƒõtov√Ω modul"
        ></button>

        <!-- SLOT 6: Rezerva (zat√≠m info) -->
        <button
          class="revia-slot"
          id="slotExtra"
          type="button"
          aria-label="Budouc√≠ speci√°ln√≠ dovednost"
        ></button>
      </div>

      <!-- Revia chat panel -->
      <div class="revia-chat" id="reviaChat">
        <div class="revia-chat-head">
          <span>Revia chat</span>
          <button id="revChatClose" type="button">√ó</button>
        </div>

        <div class="revia-chat-body" id="reviaChatBody">
          <div class="rev-chat-line rev-chat-revia">
            <span class="rev-chat-name">Revia:</span>
            <span>Jsem tady. Napi≈° mi, co dnes hl√≠d√°m ‚Äì svƒõt, tebe, nebo oboj√≠.</span>
          </div>
        </div>

        <div class="revia-chat-input">
          <input
            id="revChatInput"
            type="text"
            placeholder="Napi≈° my≈°lenku nebo ot√°zku‚Ä¶"
          />
          <button id="revChatSend" type="button">‚û§</button>
        </div>
      </div>

      <!-- spodn√≠ toast (mal√© hl√°≈°ky) -->
      <div class="revia-toast" id="revToast" aria-live="polite"></div>
    </div>

    <script>
      // Pomocn√° funkce pro toast ‚Äì pou≈æ√≠v√° t≈ô√≠du "show", jak m√°≈° v CSS
      function showToast(message) {
        const toast = document.getElementById("revToast");
        if (!toast) return;
        toast.textContent = message;
        toast.classList.add("show");
        clearTimeout(toast._hideTimer);
        toast._hideTimer = setTimeout(() => {
          toast.classList.remove("show");
        }, 2200);
      }

      // Z√ÅPISN√çK (k≈ô√≠dlo) ‚Äì t≈ô√≠da "open" podle CSS .revia-notes.open
      (function () {
        const wing = document.getElementById("revWing");
        const notes = document.getElementById("revNotes");
        const closeBtn = document.getElementById("notesClose");
        const textarea = document.getElementById("notesText");
        const STORAGE_KEY = "revia-notes-v1";

        // naƒçti ulo≈æen√Ω text
        try {
          const saved = localStorage.getItem(STORAGE_KEY);
          if (saved) textarea.value = saved;
        } catch (e) {
          // nic, jen neukl√°dej
        }

        function openNotes() {
          notes.classList.add("open");
        }

        function closeNotes() {
          notes.classList.remove("open");
        }

        if (wing) wing.addEventListener("click", openNotes);
        if (closeBtn) closeBtn.addEventListener("click", closeNotes);

        if (textarea) {
          textarea.addEventListener("input", () => {
            try {
              localStorage.setItem(STORAGE_KEY, textarea.value || "");
            } catch (e) {}
          });
        }
      })();

      // SLOT 1 ‚Äì port√°l do Centra (hlavn√≠ index)
      (function () {
        const slotPortal = document.getElementById("slotPortal");
        if (!slotPortal) return;
        slotPortal.addEventListener("click", () => {
          showToast("Otev√≠r√°m Vivere atque FruiT ‚Ä¢ Revia & Centrum‚Ä¶");
          // cesta z /Revia/ do hlavn√≠ho indexu
          window.location.href = "../index.html";
        });
      })();

      // SLOT 2 ‚Äì Revia chat (otev≈ôe panel)
      // (samotn√° logika chatu je n√≠≈æ v samostatn√©m IIFE)
      (function () {
        const slotChat = document.getElementById("slotChat");
        const panel = document.getElementById("reviaChat");
        if (!slotChat || !panel) return;

        slotChat.addEventListener("click", () => {
          panel.classList.add("is-open");
          const input = document.getElementById("revChatInput");
          if (input) setTimeout(() => input.focus(), 40);
        });
      })();

      // SLOT 3 ‚Äì P≈ôepnout AI / Human
      (function () {
        const main = document.getElementById("reviaMain");
        const state = document.getElementById("revState");
        const slotControl = document.getElementById("slotControl");

        if (!main || !state || !slotControl) return;

        function updateState() {
          const mode = main.getAttribute("data-control") || "ai";
          if (mode === "ai") {
            state.textContent = "AI: hl√≠d√°m svƒõt";
          } else {
            state.textContent = "Human: p≈ôeb√≠r√°m ≈ô√≠zen√≠";
          }
        }

        updateState();

        slotControl.addEventListener("click", () => {
          const current = main.getAttribute("data-control") || "ai";
          const next = current === "ai" ? "human" : "ai";
          main.setAttribute("data-control", next);
          updateState();

          if (next === "ai") {
            showToast("Revia ≈ô√≠zen√≠ vrac√≠ AI, ty jen hl√≠dej, jak se svƒõt chov√°.");
          } else {
            showToast("Revia d√°v√° ≈ô√≠zen√≠ tobƒõ. Svƒõt se p≈ôizp≈Øsob√≠ tobƒõ.");
          }
        });
      })();

      // SLOT 4 ‚Äì Andƒõl / ƒé√°bel (p≈ôep√≠n√°n√≠ re≈æimu + glyph)
      (function () {
        const main = document.getElementById("reviaMain");
        const glyph = document.getElementById("slotModeGlyph");
        const slotMode = document.getElementById("slotMode");

        if (!main || !glyph || !slotMode) return;

        function setAngel() {
          main.setAttribute("data-mode", "angel");
          glyph.textContent = "„Äåƒ™‚Äô‚ô°";
          showToast("Revia p≈ôepnuta do andƒõlsk√©ho re≈æimu (hl√≠d√° svƒõt jemnƒõji).");
        }

        function setDaemon() {
          main.setAttribute("data-mode", "daemon");
          glyph.textContent = "„Äåƒ™‚Äô‚òÜ";
          showToast("Revia p≈ôepnuta do ƒè√°belsk√©ho re≈æimu (p≈ô√≠snƒõj≈°√≠ dohled).");
        }

        // v√Ωchoz√≠ stav ‚Äì andƒõl
        setAngel();

        slotMode.addEventListener("click", () => {
          const mode = main.getAttribute("data-mode") || "angel";
          if (mode === "angel") {
            setDaemon();
          } else {
            setAngel();
          }
        });
      })();

      // SLOT 5 + 6 ‚Äì zat√≠m jen info
      (function () {
        const world = document.getElementById("slotWorld");
        const extra = document.getElementById("slotExtra");

        if (world) {
          world.addEventListener("click", () => {
            showToast("Tady bude pozdƒõji p≈ô√≠m√Ω vstup na nƒõkter√Ω z VaFT svƒõt≈Ø.");
          });
        }

        if (extra) {
          extra.addEventListener("click", () => {
            showToast("Rezervovan√Ω slot pro budouc√≠ speci√°ln√≠ dovednost Revie.");
          });
        }
      })();

      // ü™Ω / üî• Revia chat ‚Äì lok√°ln√≠ mozek, andƒõl vs. ƒè√°bel
      (function () {
        const panel = document.getElementById("reviaChat");
        const closeBtn = document.getElementById("revChatClose");
        const input = document.getElementById("revChatInput");
        const sendBtn = document.getElementById("revChatSend");
        const body = document.getElementById("reviaChatBody");
        const main = document.getElementById("reviaMain");

        if (!panel || !closeBtn || !input || !sendBtn || !body || !main) return;

        function closePanel() {
          panel.classList.remove("is-open");
        }

        closeBtn.addEventListener("click", closePanel);

        function addLine(name, text, who) {
          const line = document.createElement("div");
          line.className =
            "rev-chat-line " + (who === "human" ? "rev-chat-human" : "rev-chat-revia");

          const n = document.createElement("span");
          n.className = "rev-chat-name";
          n.textContent = name + ":";

          const t = document.createElement("span");
          t.textContent = " " + text;

          line.appendChild(n);
          line.appendChild(t);
          body.appendChild(line);
          body.scrollTop = body.scrollHeight;
        }

        function getMode() {
          return main.getAttribute("data-mode") === "daemon" ? "daemon" : "angel";
        }

        function replyAngel(text) {
          const lower = text.toLowerCase();
          if (lower.includes("unav") || lower.includes("sp√°t")) {
            return "Klid, sp√°nek je taky souƒç√°st syst√©mu. Staƒç√≠ jeden dal≈°√≠ den, nemus√≠≈° stihnout v≈°echno dnes.";
          }
          if (lower.includes("strach") || lower.includes("boj√≠m")) {
            return "J√° hl√≠d√°m, ty c√≠t√≠≈°. Strach jenom ukazuje, kde m√°≈° d√°t v√≠c svƒõtla, ne kde se m√°≈° vzd√°t.";
          }
          if (lower.includes("co m√°m") || lower.includes("co dƒõlat")) {
            return "Vyber jeden mal√Ω krok. Napi≈° ho sem a j√° ti p≈ôipomenu, proƒç ho dƒõl√°≈°.";
          }
          return "Zapisuji to do sv√©ho k≈ô√≠dla. Nejsi na to s√°m ‚Äì svƒõt se bude oh√Ωbat podle tebe, ne opaƒçnƒõ.";
        }

        function replyDaemon(text) {
          const lower = text.toLowerCase();
          if (lower.includes("sp√°t") || lower.includes("lenost") || lower.includes("prokrast")) {
            return "Tak jo. M≈Ø≈æe≈° j√≠t sp√°t‚Ä¶ ale pak neposouvej svƒõt. Vyber si: pohodl√≠ nebo upgrade.";
          }
          if (lower.includes("strach") || lower.includes("boj√≠m")) {
            return "Strach? Dob≈ôe. Tak udƒõl√°me p≈ôesnƒõ tu jednu vƒõc, kter√© se boj√≠≈° nejm√≠≈à ‚Äì hned teƒè.";
          }
          if (lower.includes("co m√°m") || lower.includes("co dƒõlat")) {
            return "Vyber jednu akci, kter√° tƒõ fakt posune. Napi≈° ji sem jednou vƒõtou. Pak ji prostƒõ udƒõl√°≈°. ≈Ω√°dn√Ω drama.";
          }
          return "Jestli to mysl√≠≈° v√°≈ænƒõ, p≈ôepi≈° to na konkr√©tn√≠ krok. Jinak je to jen ≈°um v hlavƒõ.";
        }

        async function askRevia(text) {
          const mode = getMode();
          if (mode === "daemon") {
            return replyDaemon(text);
          } else {
            return replyAngel(text);
          }
        }

        async function handleSend() {
          const text = (input.value || "").trim();
          if (!text) return;

          addLine("Human", text, "human");
          input.value = "";

          const reply = await askRevia(text);
          setTimeout(() => {
            addLine("Revia", reply, "revia");
          }, 200);
        }

        sendBtn.addEventListener("click", handleSend);
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            handleSend();
          }
        });
      })();
    </script>
  </body>
</html>
