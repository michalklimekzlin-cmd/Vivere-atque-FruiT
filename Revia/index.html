<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <title>Revia • Vivere atque FruiT</title>

    <!-- hlavní styl Revia -->
    <link rel="stylesheet" href="./revia.css?v=0.6" />

    <!-- jen jemné doladění pozice pozadí podle výšky zařízení -->
    <style>
      body {
        background-size: auto 70vh;
        background-position: center 18vh;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-color: #000;
      }
      @media (max-height: 820px) {
        body {
          background-size: auto 68vh;
          background-position: center 20vh;
        }
      }
      @media (min-height: 900px) {
        body {
          background-size: auto 78vh;
          background-position: center 15vh;
        }
      }
      @media (max-width: 480px) {
        body {
          background-size: auto 88vh;
          background-position: center 0;
        }
      }

      /* nové styly pro víc-záložkový zápisník */
      .revia-notes {
        /* zbytek vzhledu máš v revia.css; tady jen jistota pro layout */
        max-width: 420px;
      }

      .notes-tabs {
        display: flex;
        gap: 6px;
        margin: 6px 0 4px;
      }

      .notes-tab {
        flex: 1;
        border: 0;
        padding: 4px 6px;
        border-radius: 999px;
        font-size: 11px;
        background: rgba(0, 0, 0, 0.55);
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
      }

      .notes-tab.is-active {
        background: linear-gradient(90deg, #40f0ff, #7dfffb);
        color: #001018;
      }

      .notes-body {
        margin-top: 4px;
      }

      .notes-view {
        display: none;
      }

      .notes-view.is-active {
        display: block;
      }

      #notesTextDay,
      #notesTextRule,
      #notesTextList {
        width: 100%;
        min-height: 70px;
        max-height: 120px;
        resize: vertical;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(0, 0, 0, 0.65);
        color: #fff;
        padding: 6px 8px;
        font-size: 11px;
        outline: none;
      }
    </style>
  </head>

  <body>
    <!-- hlavní kontejner – data-mode: angel / daemon -->
    <div class="revia-main" data-mode="angel" data-control="ai">
      <!-- horní lišta -->
      <div class="revia-topbar">
        <button
          class="revia-wing"
          id="revWing"
          aria-label="otevřít zápisník"
        ></button>
        <div class="revia-title">Revia</div>
        <div class="revia-state" id="revState">AI: hlídám svět</div>
      </div>

      <!-- zápisník / křídlo – 3 záložky -->
      <div class="revia-notes" id="revNotes">
        <div class="notes-head">
          <span>✧ Křídlo / zápis</span>
          <button id="notesClose" type="button">×</button>
        </div>

        <div class="notes-tabs">
          <button
            class="notes-tab is-active"
            data-notes-target="notes-day"
            type="button"
          >
            Dnes
          </button>
          <button
            class="notes-tab"
            data-notes-target="notes-rule"
            type="button"
          >
            Pravidlo
          </button>
          <button
            class="notes-tab"
            data-notes-target="notes-list"
            type="button"
          >
            Seznam
          </button>
        </div>

        <div class="notes-body">
          <div class="notes-view is-active" id="notes-day">
            <textarea
              id="notesTextDay"
              placeholder="Co je dnešní myšlenka nebo pocit?"
            ></textarea>
          </div>

          <div class="notes-view" id="notes-rule">
            <textarea
              id="notesTextRule"
              placeholder="Krátké pravidlo, které ti Revia připomíná."
            ></textarea>
          </div>

          <div class="notes-view" id="notes-list">
            <textarea
              id="notesTextList"
              placeholder="Nápady, úkoly, věci, které nechceš ztratit…"
            ></textarea>
          </div>
        </div>

        <p class="notes-foot">
          Všechno se ukládá jen do tohoto zařízení (3 samostatné zápisy).
        </p>
      </div>

      <!-- mřížka slotů – 2×3 -->
      <div class="revia-card">
        <!-- 1) &』 – odkaz na hlavní Centrum -->
        <button class="revia-slot" id="slotCentrum" type="button">
          <span class="revia-glyph">&amp;』</span>
        </button>

        <!-- 2) Vstoupit – zatím jen placeholder, později level / hra -->
        <button class="revia-slot" id="slotEnter" type="button">
          <span class="revia-label">Vstoupit</span>
        </button>

        <!-- 3) Přepnout svět – volá reviaRotate() -->
        <button class="revia-slot" id="slotRotate" type="button">
          <span class="revia-label">Přepnout svět</span>
        </button>

        <!-- 4) Anděl / ďábel – přepínání režimu -->
        <button class="revia-slot" id="slotModeGlyph" type="button">
          <span class="revia-glyph" id="slotModeGlyphSpan">Ī’♡</span>
        </button>

        <!-- 5–6) volné sloty pro další dovednosti -->
        <button class="revia-slot" type="button"></button>
        <button class="revia-slot" type="button"></button>
      </div>

      <!-- spodní „toast“ hlášky -->
      <div class="revia-toast" id="revToast" aria-live="polite"></div>
    </div>

    <!-- jednoduchý modul pro „otáčení světa“ -->
    <script>
      const REVIA_WORLD_MODES = ["vafiti", "glyph", "engine"];
      let revWorldIndex = 0;

      function reviaRotate() {
        revWorldIndex = (revWorldIndex + 1) % REVIA_WORLD_MODES.length;
        const mode = REVIA_WORLD_MODES[revWorldIndex];
        document.body.setAttribute("data-world", mode);
        console.log("Revia otočila svět na:", mode);
      }
    </script>

    <!-- hlavní logika Revie (animace, texty, toast) -->
    <script src="./revia.js?v=0.6"></script>
    <!-- VaFT core (pokud něco sdílíme mezi moduly) -->
    <script src="../vaft-core.js"></script>

    <!-- DOPLŇKOVÁ LOGIKA: zápisník + sloty (&』, anděl/ďábel, otočit svět) -->
    <script>
      // ZÁPISNÍK (křídlo) – 3 záložky
      (function () {
        const wing = document.getElementById("revWing");
        const notes = document.getElementById("revNotes");
        const closeBtn = document.getElementById("notesClose");

        const tabButtons = document.querySelectorAll(".notes-tab");
        const views = document.querySelectorAll(".notes-view");

        const day = document.getElementById("notesTextDay");
        const rule = document.getElementById("notesTextRule");
        const list = document.getElementById("notesTextList");

        const KEYS = {
          day: "revia-notes-day-v1",
          rule: "revia-notes-rule-v1",
          list: "revia-notes-list-v1",
        };

        function openNotes() {
          notes.classList.add("is-open");
        }

        function closeNotes() {
          notes.classList.remove("is-open");
        }

        if (wing) wing.addEventListener("click", openNotes);
        if (closeBtn) closeBtn.addEventListener("click", closeNotes);

        // přepínání záložek
        tabButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const targetId = btn.getAttribute("data-notes-target");
            if (!targetId) return;

            tabButtons.forEach((b) => b.classList.remove("is-active"));
            btn.classList.add("is-active");

            views.forEach((view) => {
              view.classList.toggle(
                "is-active",
                view.id === targetId
              );
            });
          });
        });

        // načtení uložených textů
        try {
          if (day) day.value = localStorage.getItem(KEYS.day) || "";
          if (rule) rule.value = localStorage.getItem(KEYS.rule) || "";
          if (list) list.value = localStorage.getItem(KEYS.list) || "";
        } catch (e) {
          // když storage nejede, prostě nic
        }

        function attachAutosave(el, key) {
          if (!el) return;
          el.addEventListener("input", () => {
            try {
              localStorage.setItem(key, el.value || "");
            } catch (e) {}
          });
        }

        attachAutosave(day, KEYS.day);
        attachAutosave(rule, KEYS.rule);
        attachAutosave(list, KEYS.list);
      })();

      // SLOTY – &』, anděl/ďábel, otočit svět
      (function () {
        const main = document.querySelector(".revia-main");

        const slotCentrum = document.getElementById("slotCentrum");
        const slotRotate = document.getElementById("slotRotate");
        const slotMode = document.getElementById("slotModeGlyph");
        const slotModeGlyphSpan = document.getElementById(
          "slotModeGlyphSpan"
        );

        // &』 → hlavní Centrum
        if (slotCentrum) {
          slotCentrum.addEventListener("click", () => {
            window.location.href = "../index.html";
          });
        }

        // Přepnout svět → volá reviaRotate()
        if (slotRotate) {
          slotRotate.addEventListener("click", () => {
            reviaRotate();
          });
        }

        // anděl / ďábel → přepínání data-mode + glyphu
        function setMode(mode) {
          if (!main) return;
          main.setAttribute("data-mode", mode);

          if (!slotModeGlyphSpan) return;
          if (mode === "angel") {
            slotModeGlyphSpan.textContent = "Ī’♡";
          } else {
            slotModeGlyphSpan.textContent = "Ī’☆";
          }
        }

        if (slotMode) {
          slotMode.addEventListener("click", () => {
            const current =
              (main && main.getAttribute("data-mode")) || "angel";
            const next = current === "angel" ? "daemon" : "angel";
            setMode(next);
          });
        }

        // jistota: nastavíme start na andělský režim
        setMode("angel");
      })();
    </script>
  </body>
</html>
