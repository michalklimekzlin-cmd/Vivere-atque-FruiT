<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Vivere atque FruiT • RPG Kostka</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: radial-gradient(circle at top, #1a1c27, #05060a);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #f5f5f5;
      }

      .root {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
      }

      .hud {
        padding: 8px 12px;
        font-size: 13px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      .hud-left {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .hud-title {
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        font-size: 11px;
        opacity: 0.8;
      }

      .hud-sub {
        font-size: 12px;
        opacity: 0.9;
      }

      .hud-right {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
      }

      .tag {
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(250, 250, 250, 0.18);
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        opacity: 0.85;
      }

      .canvas-wrap {
        flex: 1;
        position: relative;
      }

      canvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        touch-action: none;
      }

      .controls {
        padding: 8px 12px 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      .control-group {
        display: grid;
        grid-template-columns: repeat(3, 42px);
        grid-template-rows: repeat(3, 42px);
        gap: 4px;
      }

      .control-group button {
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: rgba(15, 18, 30, 0.95);
        color: #f5f5f5;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        outline: none;
      }

      .control-group button:active {
        transform: scale(0.96);
        background: rgba(40, 45, 70, 0.95);
      }

      .control-group button.empty {
        opacity: 0;
        pointer-events: none;
      }

      .control-side {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 12px;
      }

      .switcher {
        display: inline-flex;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        overflow: hidden;
      }

      .switcher button {
        border: none;
        background: transparent;
        padding: 4px 10px;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(245, 245, 245, 0.75);
        cursor: pointer;
      }

      .switcher button.active {
        background: rgba(90, 210, 150, 0.18);
        color: #b8ffdf;
      }

      @media (max-width: 600px) {
        .controls {
          padding-inline: 8px;
        }
        .control-group {
          grid-template-columns: repeat(3, 36px);
          grid-template-rows: repeat(3, 36px);
        }
        .control-group button {
          border-radius: 10px;
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="root">
      <div class="hud">
        <div class="hud-left">
          <div class="hud-title">Vivere atque FruiT • Mini RPG</div>
          <div class="hud-sub">Kostka = svět, VaFiT + Vivere = parťáci uvnitř.</div>
        </div>
        <div class="hud-right">
          <div class="tag">Level 0 · Test Kostka</div>
        </div>
      </div>

      <div class="canvas-wrap">
        <canvas id="game"></canvas>
      </div>

      <div class="controls">
        <div class="control-side">
          <div>◀ Ovládání pohybu</div>
          <div class="control-group" id="move-controls">
            <button class="empty"></button>
            <button data-dx="0" data-dy="-1">▲</button>
            <button class="empty"></button>
            <button data-dx="-1" data-dy="0">◀</button>
            <button class="empty"></button>
            <button data-dx="1" data-dy="0">▶</button>
            <button class="empty"></button>
            <button data-dx="0" data-dy="1">▼</button>
            <button class="empty"></button>
          </div>
        </div>

        <div class="control-side">
          <div>Aktuálně ovládáš:</div>
          <div class="switcher" id="who-switcher">
            <button data-who="vafit" class="active">VaFiT (panáček)</button>
            <button data-who="vivere">Vivere (mráček)</button>
          </div>
          <div style="font-size: 11px; opacity: 0.8;">
            Tip: na počítači můžeš použít šipky. Přepínač nahoře mění postavu.
          </div>
        </div>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("game");
      const ctx = canvas.getContext("2d");

      let width = 0;
      let height = 0;

      const state = {
        active: "vafit", // "vafit" nebo "vivere"
        floorRect: { x: 0, y: 0, w: 0, h: 0 },
        vafit: { u: 0.5, v: 0.5 },
        vivere: { u: 0.3, v: 0.6 },
      };

      function resize() {
        const rect = canvas.getBoundingClientRect();
        width = canvas.width = rect.width * window.devicePixelRatio;
        height = canvas.height = rect.height * window.devicePixelRatio;
        ctx.setTransform(window.devicePixelRatio, 0, 0, window.devicePixelRatio, 0, 0);

        const marginX = width / window.devicePixelRatio * 0.15;
        const marginYTop = height / window.devicePixelRatio * 0.1;
        const marginYBottom = height / window.devicePixelRatio * 0.2;
        const w = (width / window.devicePixelRatio) - marginX * 2;
        const h = (height / window.devicePixelRatio) - marginYTop - marginYBottom;

        state.floorRect = {
          x: marginX,
          y: marginYTop + h * 0.4,
          w,
          h: h * 0.5,
        };
      }

      window.addEventListener("resize", resize);
      resize();

      function uvToXY(u, v) {
        const { x, y, w, h } = state.floorRect;
        return {
          x: x + u * w,
          y: y + v * h,
        };
      }

      function drawCube() {
        const { x, y, w, h } = state.floorRect;
        const topHeight = h * -0.9;
        const shrink = w * 0.18;

        const floor = [
          { x: x, y: y },
          { x: x + w, y: y },
          { x: x + w, y: y + h },
          { x: x, y: y + h },
        ];

        const top = [
          { x: x + shrink, y: y + topHeight },
          { x: x + w - shrink, y: y + topHeight },
          { x: x + w - shrink, y: y + topHeight - h * 0.15 },
          { x: x + shrink, y: y + topHeight - h * 0.15 },
        ];

        ctx.strokeStyle = "rgba(255, 230, 180, 0.8)";
        ctx.lineWidth = 2;

        // floor
        ctx.beginPath();
        floor.forEach((p, i) => {
          if (i === 0) ctx.moveTo(p.x, p.y);
          else ctx.lineTo(p.x, p.y);
        });
        ctx.closePath();
        ctx.stroke();

        // top
        ctx.beginPath();
        top.forEach((p, i) => {
          if (i === 0) ctx.moveTo(p.x, p.y);
          else ctx.lineTo(p.x, p.y);
        });
        ctx.closePath();
        ctx.stroke();

        // verticals
        ctx.beginPath();
        ctx.moveTo(floor[0].x, floor[0].y);
        ctx.lineTo(top[0].x, top[0].y);
        ctx.moveTo(floor[1].x, floor[1].y);
        ctx.lineTo(top[1].x, top[1].y);
        ctx.moveTo(floor[2].x, floor[2].y);
        ctx.lineTo(top[2].x, top[2].y);
        ctx.moveTo(floor[3].x, floor[3].y);
        ctx.lineTo(top[3].x, top[3].y);
        ctx.stroke();
      }

      function drawCharacter(char, type) {
        const { x, y } = uvToXY(char.u, char.v);

        if (type === "vafit") {
          // jednoduchý panáček
          const bodyHeight = 40;
          const headRadius = 12;

          ctx.strokeStyle =
            state.active === "vafit" ? "#7dffb8" : "rgba(180, 255, 220, 0.9)";
          ctx.lineWidth = 3;

          // tělo
          ctx.beginPath();
          ctx.moveTo(x, y - bodyHeight * 0.1);
          ctx.lineTo(x, y - bodyHeight * 0.9);
          ctx.stroke();

          // ruce
          ctx.beginPath();
          ctx.moveTo(x - bodyHeight * 0.4, y - bodyHeight * 0.5);
          ctx.lineTo(x + bodyHeight * 0.4, y - bodyHeight * 0.5);
          ctx.stroke();

          // nohy
          ctx.beginPath();
          ctx.moveTo(x, y - bodyHeight * 0.1);
          ctx.lineTo(x - bodyHeight * 0.4, y + bodyHeight * 0.4);
          ctx.moveTo(x, y - bodyHeight * 0.1);
          ctx.lineTo(x + bodyHeight * 0.4, y + bodyHeight * 0.4);
          ctx.stroke();

          // hlava
          ctx.beginPath();
          ctx.arc(x, y - bodyHeight, headRadius, 0, Math.PI * 2);
          ctx.stroke();
        } else {
          // mráček Vivere
          const r = 18;
          const bubbles = 5;
          ctx.strokeStyle =
            state.active === "vivere" ? "#ffffff" : "rgba(255, 255, 255, 0.8)";
          ctx.lineWidth = 2.4;

          ctx.beginPath();
          for (let i = 0; i < bubbles; i++) {
            const angle = (i / bubbles) * Math.PI * 2;
            const bx = x + Math.cos(angle) * r * 0.7;
            const by = y - 30 + Math.sin(angle) * r * 0.55;
            if (i === 0) ctx.moveTo(bx + r * 0.4, by);
            ctx.arc(bx, by, r * 0.4, angle - 0.9, angle + 0.9);
          }
          ctx.closePath();
          ctx.stroke();
        }
      }

      function draw() {
        ctx.clearRect(0, 0, width, height);

        // jemný stín pod podlahou
        ctx.fillStyle = "rgba(0, 0, 0, 0.4)";
        const { x, y, w, h } = state.floorRect;
        ctx.beginPath();
        ctx.ellipse(
          x + w / 2,
          y + h + 40,
          w * 0.55,
          h * 0.35,
          0,
          0,
          Math.PI * 2
        );
        ctx.fill();

        drawCube();
        drawCharacter(state.vafit, "vafit");
        drawCharacter(state.vivere, "vivere");

        requestAnimationFrame(draw);
      }

      requestAnimationFrame(draw);

      function moveActive(dx, dy) {
        const step = 0.06;
        const actor =
          state.active === "vafit" ? state.vafit : state.vivere;

        actor.u = Math.min(1, Math.max(0, actor.u + dx * step));
        actor.v = Math.min(1, Math.max(0, actor.v + dy * step));
      }

      // Tlačítka
      document
        .getElementById("move-controls")
        .addEventListener("click", (e) => {
          const btn = e.target.closest("button");
          if (!btn || !btn.dataset.dx) return;
          const dx = parseInt(btn.dataset.dx, 10);
          const dy = parseInt(btn.dataset.dy, 10);
          moveActive(dx, dy);
        });

      // Přepínač postavy
      document
        .getElementById("who-switcher")
        .addEventListener("click", (e) => {
          const btn = e.target.closest("button[data-who]");
          if (!btn) return;
          state.active = btn.dataset.who;
          document
            .querySelectorAll("#who-switcher button")
            .forEach((b) => b.classList.toggle("active", b === btn));
        });

      // Klávesnice (šipky)
      window.addEventListener("keydown", (e) => {
        let dx = 0,
          dy = 0;
        if (e.key === "ArrowUp") dy = -1;
        else if (e.key === "ArrowDown") dy = 1;
        else if (e.key === "ArrowLeft") dx = -1;
        else if (e.key === "ArrowRight") dx = 1;
        else return;
        e.preventDefault();
        moveActive(dx, dy);
      });
    </script>
  </body>
</html>
