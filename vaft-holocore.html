<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VaFT • HoloCore</title>
  <style>
    body { margin:0; background:#000; overflow:hidden; }
    canvas { position:fixed; inset:0; }
    #err {
      position:fixed; top:10px; left:10px;
      background:#300; padding:8px 12px;
      border-radius:8px; color:#f88;
      font-family:monospace; display:none;
      font-size:12px;
    }
  </style>
</head>

<body>
<canvas id="holo"></canvas>
<div id="err"></div>

<script type="module">
  const errBox = document.getElementById("err");

  function showErr(msg) {
    errBox.style.display = "block";
    errBox.textContent = msg;
    console.error(msg);
  }

  // === AutoLoader s fallbackem ===
  let core;
  try {
    core = await import("./VaFT-HoloCore.js?v=" + Date.now());
  } catch (e) {
    showErr("❌ Modul nelze načíst. Zkontroluj název VaFT-HoloCore.js");
  }

  if (!core) return;

  const { HoloPalette, createCurve, Motion, createHoloObject } = core;

  const canvas = document.getElementById("holo");
  const ctx = canvas.getContext("2d");

  function resize() {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
  }
  resize();
  addEventListener("resize", resize);

  // === Testovací křivka (jen aby bylo něco vidět) ===
  const test = createCurve({
    points: Array.from({ length: 80 }, (_, i) => ({
      x: 0,
      y: i * 10
    })),
    color: HoloPalette.darkRed,
    width: 2,
    wave: 4,
    opacity: 0.9
  });

  const holo = createHoloObject({
    curves: [test],
    glow: 0.5,
    particles: 30
  });

  function draw(t) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const cx = canvas.width / 2;
    const cy = canvas.height / 2;

    holo.tick(t * 0.001);

    test.points.forEach((p, i) => {
      const x = cx + Motion.waveOffset(i, t * 0.002, 12);
      const y = cy - 300 + i * 8;

      ctx.globalAlpha = test.opacity;
      ctx.strokeStyle = test.color;
      ctx.lineWidth = test.width;

      ctx.beginPath();
      ctx.moveTo(cx, y);
      ctx.lineTo(x, y);
      ctx.stroke();
    });

    requestAnimationFrame(draw);
  }

  requestAnimationFrame(draw);
</script>

</body>
</html>
