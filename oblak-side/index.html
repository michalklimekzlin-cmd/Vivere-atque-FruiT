<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>VaFT • Oblak z boku</title>
    <style>
      :root {
        --bg: #02030a;
        --mrizka: rgba(255, 220, 140, 0.08);
        --zlata: #ffd977;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #05081a 0, #02030a 55%, #000 100%);
        color: #f5f5f5;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: linear-gradient(
            to right,
            var(--mrizka) 1px,
            transparent 1px
          ),
          linear-gradient(to bottom, var(--mrizka) 1px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        mix-blend-mode: screen;
      }

      .obal {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      canvas {
        display: block;
        max-width: 100%;
        max-height: 100%;
        touch-action: none; /* důležité pro pointer eventy na mobilu */
      }

      .popisek {
        position: fixed;
        left: 10px;
        bottom: 8px;
        font-size: 11px;
        letter-spacing: 0.09em;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.5);
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="obal">
      <canvas id="oblak-platno"></canvas>
    </div>
    <div class="popisek">
      1 prst = posun • 2 prsty = posun + otočení + zoom • VaFT Oblak z boku
      \\{*(°•.)(.•°)*}//
    </div>

    <script>
      // *(°•.)(.•°)*}// VaFT • Oblak z boku – čistý obal, uvnitř zatím nic

      const platno = document.getElementById("oblak-platno");
      const ctx = platno.getContext("2d");

      // stav transformace
      let posunX = 0;
      let posunY = 0;
      let meritko = 1;
      let uhel = 0; // otočení ve 2D

      // pro gesta
      const aktivniPointery = new Map();
      let tahJednim = false;
      let posledniX = 0;
      let posledniY = 0;

      let pinchStartDist = null;
      let pinchStartUhel = null;
      let pinchStartStred = null;
      let pinchStartPosunX = 0;
      let pinchStartPosunY = 0;
      let pinchStartMeritko = 1;
      let pinchStartUhelCelkem = 0;

      function nastavPlatno() {
        const w = window.innerWidth;
        const h = window.innerHeight;
        const dpr = window.devicePixelRatio || 1;

        platno.width = w * dpr;
        platno.height = h * dpr;
        platno.style.width = w + "px";
        platno.style.height = h + "px";

        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }

      function kresliOblak() {
        const w = platno.clientWidth;
        const h = platno.clientHeight;

        ctx.clearRect(0, 0, w, h);

        const stredX = w / 2 + posunX;
        const stredY = h / 2 + posunY;

        const base = Math.min(w, h) * 0.35 * meritko;
        const polomerX = base * 1.8; // delší
        const polomerY = base * 0.45; // zúžený

        // jemný glow
        const grd = ctx.createRadialGradient(
          stredX,
          stredY,
          base * 0.1,
          stredX,
          stredY,
          base * 2.4
        );
        grd.addColorStop(0, "rgba(255, 217, 119, 0.18)");
        grd.addColorStop(0.5, "rgba(255, 217, 119, 0.06)");
        grd.addColorStop(1, "rgba(0, 0, 0, 0)");
        ctx.fillStyle = grd;
        ctx.fillRect(0, 0, w, h);

        ctx.save();
        ctx.translate(stredX, stredY);
        ctx.rotate(uhel);

        ctx.lineWidth = 1.1;
        ctx.strokeStyle = "#ffd977";
        ctx.shadowColor = "rgba(255, 220, 150, 0.55)";
        ctx.shadowBlur = 8;

        // pomocná funkce tvaru v lokálních souřadnicích (x v <-1,1>)
        function profilY(xNorm) {
          // lehce špičatější konce než čistá elipsa
          const t = 1 - Math.abs(xNorm);
          return Math.pow(t, 0.25); // zploštělé uprostřed, špičky ostřejší
        }

        // vnější obrys
        ctx.beginPath();
        const kroky = 160;
        for (let i = 0; i <= kroky; i++) {
          const t = (i / kroky) * 2 - 1; // -1..1
          const yNorm = profilY(t);
          const x = t * polomerX;
          const y = yNorm * polomerY;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        for (let i = kroky; i >= 0; i--) {
          const t = (i / kroky) * 2 - 1;
          const yNorm = -profilY(t);
          const x = t * polomerX;
          const y = yNorm * polomerY;
          ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.stroke();

        // horizontální "žebra"
        const pocetHoriz = 8;
        for (let j = 1; j < pocetHoriz; j++) {
          const v = (j / pocetHoriz) * 2 - 1; // -1..1, posun nahoru/dolu
          const yBase = v * polomerY * 0.7;

          ctx.beginPath();
          for (let i = 0; i <= kroky; i++) {
            const t = (i / kroky) * 2 - 1;
            const plochost = profilY(t);
            const y = yBase * plochost;
            const x = t * polomerX * plochost;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();
        }

        // vertikální "žebra"
        const pocetVert = 10;
        for (let k = 1; k < pocetVert; k++) {
          const pomer = (k / pocetVert) * 2 - 1; // -1..1
          const xNorm = pomer;
          const maxY = profilY(xNorm);

          ctx.beginPath();
          const krokyV = 80;
          for (let i = 0; i <= krokyV; i++) {
            const s = (i / krokyV) * 2 - 1; // -1..1
            const yNorm = s * maxY;
            const x = xNorm * polomerX * profilY(0); // skoro rovné
            const y = yNorm * polomerY;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();
        }

        ctx.restore();
        ctx.shadowBlur = 0;
      }

      function prekresli() {
        nastavPlatno();
        kresliOblak();
      }

      window.addEventListener("resize", prekresli);

      // --- OVLÁDÁNÍ GESTY ---

      platno.addEventListener("pointerdown", (e) => {
        platno.setPointerCapture(e.pointerId);
        aktivniPointery.set(e.pointerId, { x: e.clientX, y: e.clientY });

        if (aktivniPointery.size === 1) {
          tahJednim = true;
          posledniX = e.clientX;
          posledniY = e.clientY;
        } else if (aktivniPointery.size === 2) {
          // začátek pinch/rotate
          const body = Array.from(aktivniPointery.values());
          const dx = body[1].x - body[0].x;
          const dy = body[1].y - body[0].y;
          pinchStartDist = Math.hypot(dx, dy);
          pinchStartUhel = Math.atan2(dy, dx);
          pinchStartStred = {
            x: (body[0].x + body[1].x) / 2,
            y: (body[0].y + body[1].y) / 2,
          };
          pinchStartPosunX = posunX;
          pinchStartPosunY = posunY;
          pinchStartMeritko = meritko;
          pinchStartUhelCelkem = uhel;
          tahJednim = false;
        }
      });

      platno.addEventListener("pointermove", (e) => {
        if (!aktivniPointery.has(e.pointerId)) return;
        aktivniPointery.set(e.pointerId, { x: e.clientX, y: e.clientY });

        if (aktivniPointery.size === 1 && tahJednim) {
          // posun jedním prstem / myší
          const dx = e.clientX - posledniX;
          const dy = e.clientY - posledniY;
          posledniX = e.clientX;
          posledniY = e.clientY;

          posunX += dx;
          posunY += dy;
          kresliOblak();
        } else if (aktivniPointery.size === 2) {
          // pinch + otočení + posun
          const body = Array.from(aktivniPointery.values());
          const dx = body[1].x - body[0].x;
          const dy = body[1].y - body[0].y;
          const dist = Math.hypot(dx, dy);
          const u = Math.atan2(dy, dx);
          const stred = {
            x: (body[0].x + body[1].x) / 2,
            y: (body[0].y + body[1].y) / 2,
          };

          if (pinchStartDist != null) {
            const pomer = dist / pinchStartDist;
            meritko = pinchStartMeritko * pomer;
            meritko = Math.max(0.3, Math.min(4, meritko));

            const deltaUhel = u - pinchStartUhel;
            uhel = pinchStartUhelCelkem + deltaUhel;

            posunX = pinchStartPosunX + (stred.x - pinchStartStred.x);
            posunY = pinchStartPosunY + (stred.y - pinchStartStred.y);
          }

          kresliOblak();
        }
      });

      function konecPointeru(e) {
        aktivniPointery.delete(e.pointerId);
        if (aktivniPointery.size < 2) {
          pinchStartDist = null;
          pinchStartUhel = null;
          pinchStartStred = null;
        }
        if (aktivniPointery.size === 0) {
          tahJednim = false;
        }
      }

      platno.addEventListener("pointerup", konecPointeru);
      platno.addEventListener("pointercancel", konecPointeru);
      platno.addEventListener("pointerout", konecPointeru);

      // pro myš – kolečko = zoom kolem středu obrazovky
      platno.addEventListener(
        "wheel",
        (e) => {
          e.preventDefault();
          const delta = -e.deltaY || e.wheelDelta;
          const faktor = delta > 0 ? 1.1 : 0.9;
          meritko *= faktor;
          meritko = Math.max(0.3, Math.min(4, meritko));
          kresliOblak();
        },
        { passive: false }
      );

      // start
      prekresli();
    </script>
  </body>
</html>
