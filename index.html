<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Vivere atque FruiT</title>
    <meta name="theme-color" content="#020617" />
    <style>
      :root {
        --bg: radial-gradient(circle at top, #020617 0%, #010814 40%, #000 100%);
        --card: rgba(2,6,23,.6);
        --card-soft: rgba(2,6,23,.35);
        --line: rgba(148,163,184,.03);
        --txt: #e2e8f0;
        --muted: rgba(226,232,240,.45);
        --accent: #38bdf8;
        --accent2: #22c55e;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        background: var(--bg);
        color: var(--txt);
        font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", sans-serif;
        padding-bottom: calc(90px + env(safe-area-inset-bottom));
      }

      /* top */
      .topbar {
        padding: 16px 16px 0;
        display: flex;
        justify-content: space-between;
        gap: 12px;
        align-items: center;
      }
      .brand-block {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .brand-mini { font-size: .58rem; opacity: .5; }
      .brand-title { font-size: 1.15rem; font-weight: 600; }
      .role-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(59,130,246,.05);
        border: 1px solid rgba(59,130,246,.4);
        border-radius: 999px;
        padding: 3px 10px 4px;
        font-size: .62rem;
      }
      .coins {
        background: rgba(15,23,42,.6);
        border: 1px solid rgba(148,163,184,.19);
        border-radius: 14px;
        padding: 6px 10px 5px;
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .coin-icon {
        width: 22px; height: 22px;
        border-radius: 999px;
        display: flex; align-items: center; justify-content: center;
        background: radial-gradient(circle, #eab308 0%, #92400e 90%);
        font-size: .6rem;
      }
      .coin-txt { line-height: 1.1; font-size: .6rem; text-align: right; }
      .coin-ver { opacity: .4; }

      /* revia panel */
      .revia-panel {
        margin: 14px 16px 0;
        background: radial-gradient(circle at center, rgba(2,6,23,.65) 0%, rgba(2,6,23,0) 70%);
        border: 1px solid rgba(148,163,184,.05);
        border-radius: 20px;
        padding: 10px 10px 16px;
        position: relative;
      }
      .revia-head { display:flex; justify-content:space-between; align-items:center; }
      .revia-title { font-weight:500; }
      .revia-link { color:var(--accent); font-size:.68rem; }
      .rules {
        margin-top: 6px;
        background: rgba(15,23,42,.35);
        border: 1px solid rgba(148,163,184,.1);
        border-radius: 12px;
        padding: 6px 8px;
        font-size: .6rem;
        line-height: 1.25;
        width: fit-content;
      }
      .pulse-line {
        margin-top: 6px;
        display: inline-flex;
        gap: 6px;
        align-items: center;
        background: rgba(248,113,113,.04);
        border: 1px solid rgba(248,113,113,.12);
        border-radius: 999px;
        padding: 4px 9px;
        font-size: .62rem;
      }
      .pulse-dot {
        width: 7px; height: 7px; border-radius: 999px;
        background: #f43f5e;
        animation: blip 2s infinite;
      }
      @keyframes blip { 0%,100%{opacity:1} 50%{opacity:.2} }

      .center-orbit {
        position: relative;
        margin-top: 18px;
        height: 205px;
      }
      .vaft-core {
        position: absolute;
        top: 50%; left: 50%;
        width: 130px; height: 130px;
        margin-left: -65px; margin-top: -65px;
        border: 1px solid rgba(56,189,248,.4);
        border-radius: 999px;
        display: flex; align-items: center; justify-content: center;
        text-align: center;
        font-size: .62rem;
        color: rgba(226,232,240,.9);
        animation: spin 12s linear infinite;
      }
      @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
      .orbit-node {
        position:absolute;
        width:70px;height:70px;
        border-radius:999px;
        border:1px solid rgba(126,248,156,.48);
        background:rgba(15,23,42,.15);
        backdrop-filter:blur(4px);
        display:flex;align-items:center;justify-content:center;
        font-size:.58rem;
      }
      .node-glyph { left:10px; bottom:6px; }
      .node-ai { right:14px; top:12px; }
      .node-world { right:16px; bottom:12px; }

      /* tabs */
      .tabs {
        margin: 10px 16px 0;
        display: flex;
        gap: 8px;
      }
      .tab-btn {
        flex: 1;
        background: rgba(15,23,42,.08);
        border-radius: 14px;
        padding: 6px 7px 7px;
        text-align: center;
        font-size: .7rem;
        color: #e2e8f0;
        border: 1px solid transparent;
      }
      .tab-btn.active {
        background: linear-gradient(140deg, #22c55e, #06b6d4);
        border: 1px solid rgba(255,255,255,.04);
        color: #fff;
      }

      .panel {
        margin: 10px 16px 0;
        background: rgba(2,6,23,.55);
        border: 1px solid rgba(148,163,184,.03);
        border-radius: 16px;
        padding: 10px 10px 14px;
        display: none;
      }
      .panel.active { display:block; }
      .panel-title { font-weight:600; margin-bottom:8px; }

      /* HRDINOV√â */
      .hero-input,
      .hero-select {
        width: 100%;
        background: rgba(15,23,42,.5);
        border: 1px solid rgba(148,163,184,.12);
        border-radius: 10px;
        padding: 6px 8px;
        color: #fff;
        font-size: .7rem;
        margin-bottom: 7px;
      }
      .btn-primary {
        background: #0ea5e9;
        border: none;
        border-radius: 999px;
        color: #fff;
        padding: 6px 12px;
        font-size: .7rem;
        font-weight: 500;
      }
      #selectedVafit { font-size:.6rem; opacity:.65; margin-top:7px; }

      /* MEZIPROSTOR CHAT */
      #hlavoun-chat {
        background: rgba(1,4,10,.3);
        border: 1px solid rgba(148,163,184,.03);
        border-radius: 12px;
        padding: 8px;
        max-height: 195px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: .64rem;
      }
      .msg-user { }
      .msg-ai { }

      /* SYST√âM / APPKY */
      .apps-wrap {
        margin-top: 6px;
        border: 1px solid rgba(148,163,184,.03);
        border-radius: 14px;
        overflow: hidden;
      }
      .app-row {
        padding: 8px 9px;
        border-bottom: 1px solid rgba(148,163,184,.03);
      }
      .app-row:last-child { border-bottom:none; }
      .app-name { font-size:.75rem; }
      .app-desc { font-size:.58rem; opacity:.45; }
      .app-btn {
        background: rgba(56,189,248,.12);
        border: 1px solid rgba(56,189,248,.04);
        border-radius: 8px;
        padding: 4px 10px;
        color: #fff;
        font-size: .62rem;
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <!-- TOP -->
    <div class="topbar">
      <div class="brand-block">
        <div class="brand-mini">ƒ¨‚Äô‚ô° ‚Üì</div>
        <div class="brand-title">Vivere atque FruiT</div>
        <div class="role-badge">üß† Hlavoun</div>
      </div>
      <div class="coins">
        <div class="coin-icon">üí∞</div>
        <div class="coin-txt">
          <div>0</div>
          <div class="coin-ver">v0.31 ‚Ä¢ ≈æiv√Ω z√°klad</div>
        </div>
      </div>
    </div>

    <!-- REVIA / ST≈òED -->
    <div class="revia-panel">
      <div class="revia-head">
        <div class="revia-title">Revia</div>
        <a class="revia-link" href="javascript:void(0)" onclick="openApp('./Revia/')">Otev≈ô√≠t Revii ‚Üí</a>
      </div>
      <div class="rules">
        <div>Pravidlo 1 : P≈ô√°telstv√≠</div>
        <div>Pravidlo 2 : Vivere atque frui</div>
      </div>
      <div class="pulse-line">
        <span class="pulse-dot"></span>
        <span>‚ù§Ô∏è svƒõt: puls <span id="pulseTime">00:00:00</span></span>
      </div>
      <div class="center-orbit">
        <div class="vaft-core">Vivere<br>atque FruiT</div>
        <div class="orbit-node node-glyph">Glyph</div>
        <div class="orbit-node node-ai">AI (Orbit)</div>
        <div class="orbit-node node-world">World (Core)</div>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="heroes">Hrdinov√©</button>
      <button class="tab-btn" data-tab="space">Meziprostor</button>
      <button class="tab-btn" data-tab="system">Syst√©m</button>
    </div>

    <!-- PANEL: HRDINOV√â -->
    <div class="panel active" id="panel-heroes">
      <div class="panel-title">Hrdinov√©</div>
      <label style="font-size:.6rem;opacity:.55;">Jm√©no hrdiny</label>
      <input id="hero-name" class="hero-input" placeholder="nap≈ô. Piko, Orbit, M√≠za‚Ä¶" />
      <label style="font-size:.6rem;opacity:.55;">T√Ωm</label>
      <select id="hero-team" class="hero-select">
        <option>Human (Piko)</option>
        <option>AI (Orbit)</option>
        <option>Glyph</option>
        <option>World (Core)</option>
      </select>
      <button class="btn-primary" onclick="saveHero()">+ P≈ôidat hrdinu</button>
      <div id="selectedVafit"></div>
      <div id="heroesList" style="margin-top:8px;font-size:.6rem;opacity:.6;"></div>
    </div>

    <!-- PANEL: MEZIPROSTOR (HLAVOUN) -->
    <div class="panel" id="panel-space">
      <div class="panel-title">Meziprostor (Hlavoun)</div>
      <div id="hlavoun-chat"></div>
      <div style="display:flex;gap:6px;margin-top:8px;">
        <input id="hlavoun-input" placeholder="napi≈° Hlavounovi..." style="flex:1;background:rgba(15,23,42,.4);border:1px solid rgba(148,163,184,.12);border-radius:9px;padding:5px 7px;color:#fff;font-size:.65rem;">
        <button onclick="sendToHlavoun()" style="background:#0ea5e9;border:none;border-radius:9px;padding:5px 10px;color:#fff;font-size:.65rem;">Poslat</button>
      </div>
    </div>

    <!-- PANEL: SYST√âM -->
    <div class="panel" id="panel-system">
      <div class="panel-title">Syst√©m / appky</div>
      <div class="apps-wrap">
        <div class="app-row">
          <div class="app-name">VAFT Center 3D</div>
          <div class="app-desc">p≈Øvodn√≠ 3D sc√©na</div>
          <button class="app-btn" onclick="openApp('./VAFT-Center3D/')">Otev≈ô√≠t</button>
        </div>
        <div class="app-row">
          <div class="app-name">Kometa 3I / ATLAS</div>
          <div class="app-desc">atlas dr√°hy (work in progress)</div>
          <button class="app-btn" onclick="openApp('./VAFT-Comet/')">Otev≈ô√≠t</button>
        </div>
        <div class="app-row">
          <div class="app-name">VafiT galerie</div>
          <div class="app-desc">v√Ωbƒõr a p≈ô√≠bƒõhy VafiT≈Ø</div>
          <button class="app-btn" onclick="openApp('./VafiT-gallery/index.html')">Otev≈ô√≠t</button>
        </div>
        <div class="app-row">
          <div class="app-name">Dal≈°√≠ modul</div>
          <div class="app-desc">sem p≈ôid√°≈° dal≈°√≠ slo≈æku</div>
          <button class="app-btn" onclick="alert('Tady pak p≈ôid√°me dal≈°√≠ slo≈æku üôÇ')">P≈ôidat</button>
        </div>
      </div>
    </div>

    <script>
      function openApp(url){ window.location.href = url; }

      function tick(){
        const el = document.getElementById('pulseTime');
        if(!el) return;
        const d = new Date();
        el.textContent = d.toLocaleTimeString('cs-CZ', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
      }

      function showTab(which){
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        const btn = document.querySelector('[data-tab="'+which+'"]');
        const pan = document.getElementById('panel-'+which);
        if (btn) btn.classList.add('active');
        if (pan) pan.classList.add('active');
      }

      // ulo≈æit hrdinu do localStorage
      function saveHero(){
        const name = document.getElementById('hero-name').value.trim();
        const team = document.getElementById('hero-team').value;
        if (!name) return;
        const heroes = JSON.parse(localStorage.getItem('VAFT_HEROES') || '[]');
        heroes.push({ name, team, ts: Date.now() });
        localStorage.setItem('VAFT_HEROES', JSON.stringify(heroes));
        document.getElementById('hero-name').value = '';
        renderHeroes();
        appendHlavounMsg('ai', 'Ulo≈æil jsem hrdinu ‚Äû'+name+'‚Äú. M≈Ø≈æe≈° mu p≈ôidat √∫kol v Meziprostoru.');
      }

      function renderHeroes(){
        const heroes = JSON.parse(localStorage.getItem('VAFT_HEROES') || '[]');
        const box = document.getElementById('heroesList');
        if (!box) return;
        if (!heroes.length) { box.textContent = 'Zat√≠m nem√°≈° ulo≈æen√© hrdiny.'; return; }
        box.innerHTML = heroes.map(h => '‚Ä¢ '+h.name+' ('+h.team+')').join('<br>');
      }

      /* ==== HLAVOUN ENGINE ==== */

      function appendHlavounMsg(role, text) {
        const box = document.getElementById('hlavoun-chat');
        if (!box) return;
        const row = document.createElement('div');
        const name = role === 'user' ? 'Ty' : 'Hlavoun';
        row.innerHTML = `<strong style="font-size:.6rem;opacity:.6;">${name}:</strong> <span>${text}</span>`;
        box.appendChild(row);
        box.scrollTop = box.scrollHeight;

        const log = JSON.parse(localStorage.getItem('VAFT_HLAVOUN_LOG') || '[]');
        log.push({ role, text, ts: Date.now() });
        localStorage.setItem('VAFT_HLAVOUN_LOG', JSON.stringify(log));
      }

      function loadHlavounLog() {
        const log = JSON.parse(localStorage.getItem('VAFT_HLAVOUN_LOG') || '[]');
        log.forEach(m => appendHlavounMsg(m.role, m.text));
      }

      // Hlavoun se pod√≠v√°, co m√°me v localStorage, a vymysl√≠ dal≈°√≠ krok
      function hlavounAnalyze(userText) {
        const selectedVafit = getJSON('VAFT_SELECTED_VAFIT');
        const heroes = getJSON('VAFT_HEROES', []);
        const gps = getJSON('VAFT_GPS_LOG', []);           // kdyby sis to nƒõkdy ukl√°dal
        const nature = getJSON('VAFT_NATURE_OBJECTS', []); // fotky/objekty z p≈ô√≠rody
        const sos = getJSON('VAFT_SOS', []);

        // 1) u≈æivatelsk√Ω explicitn√≠ dotaz
        if (userText) {
          const lower = userText.toLowerCase();
          if (lower.includes('p≈ô√≠bƒõh') || lower.includes('story')) {
            if (selectedVafit) {
              appendHlavounMsg('ai', 'Tak jo. VafiT ‚Äû'+selectedVafit.name+'‚Äú ('+(selectedVafit.glyph||'‚öô')+ ') m≈Ø≈æe b√Ωt nosiƒç den√≠ku. Udƒõl√°me mu misi: ‚ÄûNajdi 3 objekty z p≈ô√≠rody a ulo≈æ je.‚Äú To pak napoj√≠me na tv≈Øj panel s p≈ô√≠rodou.');
            } else {
              appendHlavounMsg('ai', 'Nejd≈ô√≠v si ale vyber VafiTa v galerii, a≈• m√°m na koho ten p≈ô√≠bƒõh napsat.');
            }
            return;
          }
          if (lower.includes('gps')) {
            appendHlavounMsg('ai', 'GPS stopu ukl√°dej jako pole bod≈Ø [{lat,lng,time}], klidnƒõ pod kl√≠ƒç VAFT_GPS_LOG. Pak ti z toho vygeneruju cestu nebo √∫kol ‚Äûprojdi trasu znovu‚Äù.');
            return;
          }
        }

        // 2) ≈æ√°dn√Ω VafiT vybran√Ω
        if (!selectedVafit) {
          appendHlavounMsg('ai', 'Je≈°tƒõ nem√°≈° vybran√©ho VafiTa. Otev≈ôi ‚ÄûVafiT galerie‚Äú v Syst√©mu, klikni na jednoho a vra≈• se ‚Äì hned mu nƒõco vymysl√≠m.');
          return;
        }

        // 3) m√°me VafiTa ale ≈æ√°dn√©ho hrdinu
        if (selectedVafit && !heroes.length) {
          appendHlavounMsg('ai', 'M√°≈° vybran√©ho VafiTa (‚Äû'+selectedVafit.name+'‚Äú), ale nem√°≈° je≈°tƒõ hrdinu. V z√°lo≈æce Hrdinov√© z nƒõj udƒõlej hrdinu nebo vytvo≈ô ƒçlovƒõka, co ho bude nosit.');
          return;
        }

        // 4) m√°me hrdiny i VafiTa ‚Äì teƒè navrhnu propojen√≠
        if (selectedVafit && heroes.length) {
          const lastHero = heroes[heroes.length - 1];
          let msg = 'Vid√≠m hrdinu ‚Äû'+lastHero.name+'‚Äú ('+lastHero.team+'). M≈Ø≈æeme mu d√°t VafiTa ‚Äû'+selectedVafit.name+'‚Äú jako vnit≈ôn√≠ jiskru.';
          if (!nature.length) {
            msg += ' Zkus hned p≈ôidat ‚Äûobjekt z p≈ô√≠rody‚Äú v tom panelu, co sis kreslil ‚Äì a j√° pak budu vƒõdƒõt, ≈æe tenhle hrdina chod√≠ ven.';
          } else {
            msg += ' U≈æ m√°≈° '+nature.length+' p≈ô√≠rodn√≠ch objekt≈Ø ‚Äì m≈Ø≈æu z toho udƒõlat √∫kol ‚Äûzmapuj m√≠sto‚Äú nebo ‚Äûvyfo≈• dal≈°√≠ 2 fotky‚Äú.';
          }
          appendHlavounMsg('ai', msg);
          return;
        }

        // 5) kdyby fakt nebylo co
        appendHlavounMsg('ai', 'Zat√≠m moc dat nem√°m, ale m≈Ø≈æeme zaƒç√≠t tak, ≈æe do Hrdin≈Ø ulo≈æ√≠≈° jedno jm√©no a v galerii vybere≈° VafiTa.');
      }

      function getJSON(key, fallback=null) {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        try { return JSON.parse(raw); } catch(e) { return fallback; }
      }

      function sendToHlavoun() {
        const inp = document.getElementById('hlavoun-input');
        if (!inp || !inp.value.trim()) return;
        const text = inp.value.trim();
        appendHlavounMsg('user', text);
        inp.value = '';
        setTimeout(() => hlavounAnalyze(text), 200);
      }

      document.addEventListener('DOMContentLoaded', () => {
        tick();
        setInterval(tick, 1000);

        // tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => showTab(btn.dataset.tab));
        });
        showTab('heroes');

        // vybran√Ω VafiT z galerie ‚Üí uk√°zat v Hrdinech
        const selectedVafit = getJSON('VAFT_SELECTED_VAFIT');
        if (selectedVafit) {
          const place = document.getElementById('selectedVafit');
          if (place) place.textContent = "Vybran√Ω VafiT: " + selectedVafit.name + " " + (selectedVafit.glyph || "");
        }

        renderHeroes();
        loadHlavounLog();

        // kdy≈æ chat byl √∫plnƒõ pr√°zdn√Ω, Hlavoun se p≈ôedstav√≠
        const log = JSON.parse(localStorage.getItem('VAFT_HLAVOUN_LOG') || '[]');
        if (!log.length) {
          appendHlavounMsg('ai', 'ƒåau, jsem Hlavoun v appce. D√≠v√°m se do localStorage a pom≈Ø≈æu ti to tu skl√°dat. Vyber VafiTa v ‚ÄúSyst√©m ‚Üí VafiT galerie‚Äù, pak mi napi≈° ‚Äúnavrhni p≈ô√≠bƒõh‚Äù.');
        }
      });
    </script>
  </body>
</html>
