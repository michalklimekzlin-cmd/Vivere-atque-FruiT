<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vivere atque FruiT</title>
    <meta name="theme-color" content="#000000" />
    <link rel="manifest" href="./manifest.json" />
    <link rel="stylesheet" href="./style.css" />
    <style>
      :root {
        --bg: #05070a;
        --panel: rgba(5, 8, 12, 0.35);
        --stroke: rgba(255, 255, 255, 0.04);
        --accent: #19d6ff;
      }
      body {
        background: var(--bg);
        color: #eef6ff;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        min-height: 100vh;
      }
      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: rgba(5, 7, 10, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255,255,255,.04);
      }
      .brand-block { display: flex; flex-direction: column; gap: 2px; }
      .brand-mini { font-size: .7rem; opacity: .65; }
      .brand-title { font-weight: 600; font-size: 1.12rem; }
      .role-badge {
        font-size: .68rem;
        color: #ffb6e1;
      }
      .coins { text-align: right; font-size: .72rem; }
      .coin-ver { opacity: .5; }
      .revia-panel {
        padding: 18px 16px 10px;
      }
      .revia-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .revia-title { font-weight: 600; }
      .revia-link { color: #7dd7ff; font-size: .7rem; text-decoration: none; }
      .rules { font-size: .7rem; opacity: .7; display: flex; gap: 12px; margin-bottom: 6px; }
      .pulse-line { font-size: .72rem; display: flex; gap: 6px; align-items: center; }
      .pulse-dot {
        width: 9px; height: 9px; border-radius: 999px;
        background: #e93454;
        box-shadow: 0 0 12px rgba(233, 52, 84, 0.7);
      }
      .center-orbit {
        position: relative;
        width: min(340px, 90vw);
        height: min(340px, 90vw);
        margin: 14px auto 6px;
      }
      .vaft-core {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%) rotate(-12deg);
        width: 180px; height: 180px;
        border: 1px solid rgba(170,206,255,.08);
        border-radius: 999px;
        display: flex; align-items: center; justify-content: center;
        text-align: center;
        font-weight: 500;
        background: radial-gradient(circle at 50% 35%, rgba(51, 72, 103, 0.18), rgba(5,7,10,0.1));
      }
      .orbit-node {
        position: absolute;
        width: 86px; height: 86px;
        border-radius: 999px;
        border: 1px solid rgba(196,253,205,.28);
        display: flex; align-items: center; justify-content: center;
        font-size: .7rem;
        background: rgba(5,8,12,.3);
      }
      .node-glyph { bottom: 12%; left: 5%; }
      .node-ai { top: 9%; right: 4%; }
      .node-world { bottom: 9%; right: 8%; }
      .tabs {
        display: flex;
        gap: 6px;
        padding: 10px 10px 0;
      }
      .tab-btn {
        flex: 1;
        background: rgba(8,11,13,.5);
        border: none;
        border-radius: 999px 999px 0 0;
        padding: 8px 0 9px;
        color: rgba(231,244,255,.55);
        font-size: .78rem;
      }
      .tab-btn.active {
        background: linear-gradient(120deg, #17d0ff, #17ffb9);
        color: #02070a;
        font-weight: 600;
      }
      .panel {
        display: none;
        padding: 14px 14px 88px;
      }
      .panel.active { display: block; }
      .panel-title { font-weight: 600; margin-bottom: 10px; }
      .label-sm { font-size: .68rem; opacity: .7; display:block; margin-bottom:3px; }
      .hero-input, .hero-select {
        width: 100%;
        background: rgba(1,1,1,.06);
        border: 1px solid rgba(255,255,255,.015);
        border-radius: 11px;
        padding: 9px 10px;
        color: #fff;
        font-size: .82rem;
        margin-bottom: 8px;
      }
      .btn-primary {
        background: #0fb2ff;
        color: #02070a;
        font-weight: 600;
        border: none;
        border-radius: 999px;
        padding: 9px 14px;
        font-size: .8rem;
      }
      #heroesList {
        margin-top: 10px;
        font-size: .78rem;
        opacity: .8;
      }
      /* meziprostor */
      #hlavoun-chat {
        background: rgba(5,8,12,.35);
        border: 1px solid rgba(255,255,255,.015);
        border-radius: 16px;
        padding: 6px 8px;
        max-height: 240px;
        overflow-y: auto;
        margin-bottom: 8px;
      }
      #hlavoun-input {
        width: calc(100% - 80px);
        background: rgba(1,1,1,.12);
        border: 1px solid rgba(255,255,255,.01);
        border-radius: 999px;
        padding: 8px 9px;
        color: #fff;
      }
      .chat-row {
        display: flex; gap: 6px; align-items: center;
        margin-bottom: 6px;
      }
      .quick-row { display: flex; gap: 6px; flex-wrap: wrap; }
      .quick-row button {
        background: rgba(5,11,13,.25);
        border: 1px solid rgba(255,255,255,.02);
        border-radius: 999px;
        padding: 6px 11px;
        font-size: .72rem;
        color: #fff;
      }
      /* system menu */
      #systemMenu {
        position: fixed;
        bottom: 88px;
        right: 12px;
        background: rgba(5,8,12,.9);
        border: 1px solid rgba(130,155,180,0.25);
        border-radius: 16px;
        padding: 14px 12px 10px;
        color: #e8f5ff;
        backdrop-filter: blur(14px);
        min-width: 240px;
        max-height: 60vh;
        overflow-y: auto;
        box-shadow: 0 8px 25px rgba(0,0,0,.35);
        z-index: 200;
      }
      #systemMenu.hidden { display: none; }
      #systemMenu h3 {
        margin: 0 0 8px;
        font-size: .78rem;
        opacity: .8;
        letter-spacing: .04em;
      }
      .sys-app {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 6px;
        margin-bottom: 6px;
      }
      .sys-app-name { font-size: .72rem; }
      .sys-app-btn {
        background: rgba(112,194,227,.12);
        border: 1px solid rgba(112,194,227,.35);
        color: #e8f5ff;
        border-radius: 9px;
        font-size: .6rem;
        padding: 3px 8px 4px;
      }
      .system-open-btn {
        margin-top: 12px;
      }
      /* s√≠≈• */
      #vaft-nodes, #vaft-nodes-outer, #vaft-nodes-mirror, #vaft-nodes-origin {
        display:flex; flex-wrap:wrap; gap:6px; margin-bottom:4px;
      }
      .node-pill {
        background: rgba(4,9,11,.35);
        border:1px solid rgba(255,255,255,.01);
        border-radius: 9px;
        padding: 4px 7px;
        font-size:.6rem;
      }
      /* spodn√≠ mezera pro iPhone */
      @media (max-width: 820px) {
        .panel { margin-bottom: 95px; }
      }
    </style>
  </head>
  <body>
    <!-- TOP -->
    <div class="topbar">
      <div class="brand-block">
        <div class="brand-mini">ƒ¨‚Äô‚ô° ‚Üì</div>
        <div class="brand-title">Vivere atque FruiT</div>
        <div class="role-badge" id="core-status">üß† Hlavoun syst√©m ‚Ä¢ aktivn√≠</div>
      </div>
      <div class="coins">
        <div>0</div>
        <div class="coin-ver">v0.31 ‚Ä¢ ≈æiv√Ω z√°klad</div>
      </div>
    </div>

    <!-- REVIA / ST≈òED -->
    <div class="revia-panel">
      <div class="revia-head">
        <div class="revia-title">Revia</div>
        <a class="revia-link" href="javascript:void(0)" onclick="openApp('./Revia/')">Otev≈ô√≠t Revii ‚Üí</a>
      </div>
      <div class="rules">
        <div>Pravidlo 1 : P≈ô√°telstv√≠</div>
        <div>Pravidlo 2 : Vivere atque frui</div>
      </div>
      <div class="pulse-line">
        <span class="pulse-dot"></span>
        <span>‚ù§Ô∏è svƒõt: puls <span id="pulseTime">00:00:00</span></span>
      </div>
      <div class="center-orbit">
        <div class="vaft-core">Vivere<br>atque FruiT</div>
        <div class="orbit-node node-glyph">Glyph</div>
        <div class="orbit-node node-ai">AI (Orbit)</div>
        <div class="orbit-node node-world">World (Core)</div>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="heroes">Hrdinov√©</button>
      <button class="tab-btn" data-tab="space">Meziprostor</button>
      <button class="tab-btn" data-tab="system">Syst√©m</button>
      <button class="tab-btn" data-tab="nodes">S√≠≈•</button>
    </div>

    <!-- PANEL: HRDINOV√â -->
    <div class="panel active" id="panel-heroes">
      <div class="panel-title">Hrdinov√©</div>
      <label class="label-sm">Jm√©no hrdiny</label>
      <input id="hero-name" class="hero-input" placeholder="nap≈ô. Piko, Orbit, M√≠za‚Ä¶" />
      <label class="label-sm">T√Ωm</label>
      <select id="hero-team" class="hero-select">
        <option>Human (Piko)</option>
        <option>AI (Orbit)</option>
        <option>Glyph</option>
        <option>World (Core)</option>
      </select>
      <button class="btn-primary" onclick="saveHero()">+ P≈ôidat hrdinu</button>
      <div id="selectedVafit"></div>
      <div id="heroesList" class="list-sm">Zat√≠m nem√°≈° ulo≈æen√© hrdiny.</div>
    </div>

    <!-- PANEL: MEZIPROSTOR -->
    <div class="panel" id="panel-space">
      <div class="panel-title">Meziprostor (Hlavoun)</div>
      <div id="hlavoun-chat"></div>
      <div class="chat-row">
        <input id="hlavoun-input" placeholder="napi≈° Hlavounovi...">
        <button class="btn-primary" onclick="sendToHlavoun()">Poslat</button>
      </div>
      <div class="quick-row">
        <button onclick="sendQuickToHlavoun('p≈ô√≠bƒõh pro vybran√©ho vafita')">üí° P≈ô√≠bƒõh</button>
        <button onclick="sendQuickToHlavoun('gps ulo≈æit')">üìç GPS</button>
        <button onclick="sendQuickToHlavoun('zkontroluj repo')">üîé Repo</button>
        <button onclick="sendQuickToHlavoun('batole svƒõt')">üçº Batole svƒõt</button>
      </div>
    </div>

    <!-- PANEL: SYST√âM -->
    <div class="panel" id="panel-system">
      <div class="panel-title">Syst√©m / appky</div>
      <p style="opacity:.65;font-size:.7rem;">
        V≈°echno jsme schovali do jednoho okna, a≈• je po≈ô√°dek. üëá
      </p>
      <button class="btn-primary system-open-btn" onclick="toggleSystemMenu()">Otev≈ô√≠t syst√©mov√© appky</button>
    </div>

    <!-- PANEL: S√ç≈§ -->
    <div class="panel" id="panel-nodes">
      <div class="panel-title">S√≠≈• uzl≈Ø</div>
      <p style="opacity:.6;font-size:.7rem;">Tady se zobrazuj√≠ v≈°echny ≈æiv√© ƒçtvereƒçky napojen√© na Vivere atque FruiT.</p>
      <div id="vaft-nodes"></div>
      <div id="vaft-nodes-outer"></div>
      <div id="vaft-nodes-mirror"></div>
      <div id="vaft-nodes-origin"></div>
      <p style="opacity:.4;font-size:.65rem;margin-top:4px;">(s√≠≈• se naƒçte a≈æ kdy≈æ ji otev≈ôe≈° ‚Äì kv≈Øli v√Ωkonu iPhonu)</p>
    </div>

    <!-- SKRYT√â SYST√âMOV√â MENU -->
    <div id="systemMenu" class="hidden">
      <h3>VAFT ‚Äì tvoje appky</h3>
      <div class="sys-app">
        <div class="sys-app-name">Vivere (hlavn√≠)</div>
        <button class="sys-app-btn" onclick="openApp('./')">Otev≈ô√≠t</button>
      </div>
      <div class="sys-app">
        <div class="sys-app-name">Braska-Hlava</div>
        <button class="sys-app-btn" onclick="openApp('./Braska-Hlava/')">Otev≈ô√≠t</button>
      </div>
      <div class="sys-app">
        <div class="sys-app-name">Hlavoun</div>
        <button class="sys-app-btn" onclick="openApp('./Hlavoun/')">Otev≈ô√≠t</button>
      </div>
      <div class="sys-app">
        <div class="sys-app-name">Meziprostor-Core</div>
        <button class="sys-app-btn" onclick="openApp('./Meziprostor-Core/')">Otev≈ô√≠t</button>
      </div>
      <div class="sys-app">
        <div class="sys-app-name">VAFT-Network</div>
        <button class="sys-app-btn" onclick="openApp('./VAFT-Network/')">Otev≈ô√≠t</button>
      </div>
    </div>

    <!-- SCRIPTS -->
    <script>
      // otev≈ôen√≠ app
      function openApp(url){ window.location.href = url; }

      // puls
      function tick(){
        const el = document.getElementById('pulseTime');
        if(!el) return;
        el.textContent = new Date().toLocaleTimeString('cs-CZ', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
      }

      // p≈ôep√≠n√°n√≠ tab≈Ø
      const _origShowTab = function(which){
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        const btn = document.querySelector('[data-tab="'+which+'"]');
        const pan = document.getElementById('panel-'+which);
        if (btn) btn.classList.add('active');
        if (pan) pan.classList.add('active');

        if (which !== 'system') {
          const m = document.getElementById('systemMenu');
          if (m) m.classList.add('hidden');
        }
      };

      function showTab(which){
        _origShowTab(which);
        // s√≠≈• naƒç√≠t√°me jen kdy≈æ je pot≈ôeba
        if (which === 'nodes' || which === 'space') {
          lazyLoadNetwork();
        }
      }

      function toggleSystemMenu() {
        const m = document.getElementById('systemMenu');
        if (!m) return;
        m.classList.toggle('hidden');
      }

      // hrdinov√©
      function saveHero(){
        const name = document.getElementById('hero-name').value.trim();
        const team = document.getElementById('hero-team').value;
        if (!name) return;
        const heroes = JSON.parse(localStorage.getItem('VAFT_HEROES') || '[]');
        const heroObj = { name, team, ts: Date.now() };
        heroes.push(heroObj);
        localStorage.setItem('VAFT_HEROES', JSON.stringify(heroes));
        document.getElementById('hero-name').value = '';
        renderHeroes();
        appendHlavounMsg('ai', 'Ulo≈æil jsem hrdinu ‚Äû'+name+'‚Äú. M≈Ø≈æe≈° ho propojit s VafiTem.');
      }

      function renderHeroes(){
        const heroes = JSON.parse(localStorage.getItem('VAFT_HEROES') || '[]');
        const box = document.getElementById('heroesList');
        if (!heroes.length) { box.textContent = 'Zat√≠m nem√°≈° ulo≈æen√© hrdiny.'; return; }
        box.innerHTML = heroes.map(h => '‚Ä¢ '+h.name+' ('+h.team+')').join('<br>');
      }

      // chat ob√°lka
      function appendHlavounMsg(role, text) {
        const box = document.getElementById('hlavoun-chat');
        if (!box) return;
        const row = document.createElement('div');
        const name = role === 'user' ? 'Ty' : 'Hlavoun';
        row.innerHTML = `<strong style="font-size:.6rem;opacity:.6;">${name}:</strong> <span>${text}</span>`;
        box.appendChild(row);
        box.scrollTop = box.scrollHeight;
        const log = JSON.parse(localStorage.getItem('VAFT_HLAVOUN_LOG') || '[]');
        log.push({ role, text, ts: Date.now() });
        localStorage.setItem('VAFT_HLAVOUN_LOG', JSON.stringify(log));
      }

      function sendToHlavoun() {
        const inp = document.getElementById('hlavoun-input');
        if (!inp || !inp.value.trim()) return;
        const text = inp.value.trim();
        appendHlavounMsg('user', text);
        inp.value = '';

        // tady m≈Ø≈æe≈° napojit tvoje skripty
        if (window.VAFTBus) {
          window.VAFTBus.handleUserMessage(text);
        }
        if (window.HlavounSystem) {
          window.HlavounSystem.think(text);
        }
        if (window.AgentBus) {
          window.AgentBus.handleUserMessage(text);
        }
      }

      function sendQuickToHlavoun(text){
        const inp = document.getElementById('hlavoun-input');
        inp.value = text;
        sendToHlavoun();
      }

      // lazy naƒçten√≠ s√≠tƒõ = kv≈Øli iPhone
      let networkLoaded = false;
      function lazyLoadNetwork() {
        if (networkLoaded) return;
        const s = document.createElement('script');
        s.src = './vaft.network.js';
        s.onload = () => {
          console.log('VAFT network p≈ôipojena');
          networkLoaded = true;
          if (window.VAFT && window.VAFT.network && window.VAFT.network.render) {
            window.VAFT.network.render('#vaft-nodes', '#vaft-nodes-outer', '#vaft-nodes-mirror', '#vaft-nodes-origin');
          }
        };
        s.onerror = () => console.warn('VAFT network.js se nenaƒçetl ‚Äì jedu bez s√≠tƒõ');
        document.body.appendChild(s);
      }

      document.addEventListener('DOMContentLoaded', () => {
        tick();
        setInterval(tick, 1000);

        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => showTab(btn.dataset.tab));
        });
        showTab('heroes');

        renderHeroes();

        const selectedVafit = JSON.parse(localStorage.getItem('VAFT_SELECTED_VAFIT') || 'null');
        if (selectedVafit) {
          const place = document.getElementById('selectedVafit');
          if (place) place.textContent = "Vybran√Ω VafiT: " + selectedVafit.name + " " + (selectedVafit.glyph || "");
        }
      });
    </script>

    <!-- tady je mozek ‚Äì tv√© st√°vaj√≠c√≠ soubory -->
    <script src="./app.js"></script>
    <script src="./hlavoun.js"></script>
    <script src="./viri.js"></script>
    <script src="./pikos.js"></script>
    <script src="./agents.js"></script>
    <script src="./agents_v3.js"></script>
    <script src="./vaft.bus.js"></script>
    <script src="./vaft.agents.js"></script>
    <script src="./vaft.engine.js"></script>
    <script src="./vaft.ascend.js"></script>
    <script src="./vaft.diagnostics.js"></script>
  </body>
</html>
