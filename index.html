<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <!-- üõ°Ô∏è Content Security Policy ‚Äì chr√°n√≠ p≈ôed vlo≈æen√≠m ciz√≠ho k√≥du -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data:;
    connect-src 'self';
    object-src 'none';
    base-uri 'self';
    form-action 'self';
    frame-ancestors 'none';
  ">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vivere atque FruiT ‚Ä¢ v0.31</title>
  <link rel="stylesheet" href="style.css?v=0.31">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
</head>
<body>
  <header class="topbar">
    <h1>Vivere atque FruiT</h1>
    <span class="version">v0.31 ‚Ä¢ ≈æiv√Ω z√°klad</span>
  </header>

  <main class="layout">
    <section class="world">
      <canvas id="worldCanvas" aria-label="Svƒõt Vivere atque FruiT"></canvas>
      <div class="world-overlay">
        <p class="rule">Pravidlo 1: P≈ô√°telstv√≠</p>
        <p class="rule">Pravidlo 2: Vivere atque frui</p>
        <p class="pulse" id="worldPulse">ü´Ä svƒõt: ƒçek√°m‚Ä¶</p>
      </div>
    </section>

    <aside class="sidebar">
      <div class="tabs">
        <button class="tab-btn active" data-tab="heroPanel">Hrdinov√©</button>
        <button class="tab-btn" data-tab="enginePanel">Meziprostor</button>
        <button class="tab-btn" data-tab="ideasPanel">Syst√©m</button>
      </div>

      <div class="panel active" id="heroPanel">
        <h2>Hrdinov√©</h2>
        <form id="heroForm">
          <label>Jm√©no hrdiny</label>
          <input type="text" id="heroName" placeholder="nap≈ô. Piko, Orbit, M√≠za‚Ä¶" required>
          <label>T√Ωm</label>
          <select id="heroTeam">
            <option value="human">Human (Piko)</option>
            <option value="ai">AI (Orbit)</option>
            <option value="glyph">Glyph</option>
            <option value="world">World (Core)</option>
          </select>
          <button type="submit">‚ûï P≈ôidat hrdinu</button>
        </form>

        <ul id="heroList"></ul>

        <!-- üîó Nov√° sekce odkazu na Reviu -->
        <div class="revia-link">
          <hr style="border:0;height:1px;background:#334;margin:12px 0;">
          <p>ü™Ω <strong>Revia</strong> ‚Äî Str√°≈ækynƒõ svƒõtla</p>
          <a href="./Revia/index.html" class="btn" style="
            display:inline-block;
            margin-top:6px;
            padding:8px 14px;
            border-radius:8px;
            border:1px solid #224;
            background:rgba(40,60,90,.5);
            color:#cfe;
            text-decoration:none;
            font-weight:600;
            backdrop-filter:blur(6px);
          ">Otev≈ô√≠t Reviu</a>
        </div>
      </div>

      <div class="panel" id="enginePanel">
        <h2>Meziprostor (engine)</h2>
        <p class="small">Spojuje 4 rohy svƒõta. Tady bude Shop / Iskry / WebGuardian.</p>
        <button id="enginePing">Pingnout meziprostor</button>
        <pre id="engineLog"></pre>
      </div>

      <div class="panel" id="ideasPanel">
        <h2>Syst√©m / n√°pady</h2>
        <textarea id="ideasBox" rows="4" placeholder="Sem si pi≈° n√°pady, pravidla, zmƒõny‚Ä¶"></textarea>
        <button id="saveIdeas">Ulo≈æit do localStorage</button>
        <p class="small" id="ideasStatus">zat√≠m neulo≈æeno</p>

        <h3>Virtu√°ln√≠ ‚Äûsoubory‚Äú svƒõta</h3>
        <form id="moduleForm">
          <input type="text" id="moduleName" placeholder="nap≈ô. webguardian.mjs" required>
          <select id="moduleState">
            <option value="enabled">zapnuto</option>
            <option value="disabled">vypnuto</option>
          </select>
          <button type="submit">Ulo≈æit modul</button>
        </form>
        <ul id="moduleList"></ul>
      </div>
    </aside>
  </main>

  <!-- skripty ‚Äì V≈ΩDY d√°vej verzi, kdy≈æ nƒõco mƒõn√≠≈° -->
  <!-- Registrace service workeru pro offline re≈æim -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js")
        .then(() => console.log("‚úÖ Service worker registrov√°n"))
        .catch(err => console.warn("‚ö†Ô∏è Service worker chyba:", err));
    }
  </script>
  <script src="src/app.js?v=0.35"></script>
  <script src="src/engine.js?v=0.35"></script>
  <script src="src/teams.js?v=0.35"></script>
  <script src="src/poutnik.js?v=0.36"></script>
  <script src="src/vaft.seal.js?v=0.36"></script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("./service-worker.js")
      .then(() => console.log("‚úÖ Service worker Revia aktivn√≠"))
      .catch(err => console.warn("‚ö†Ô∏è Revia SW chyba:", err));
  }
</script>
</body>
</html>
