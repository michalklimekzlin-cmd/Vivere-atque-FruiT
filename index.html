<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vivere atque FruiT</title>
    <meta name="theme-color" content="#000000" />
    <link rel="manifest" href="./manifest.json" />
    <link rel="stylesheet" href="./style.css" />

    <style>
      :root {
        --bg: #05070a;
        --panel: rgba(5, 8, 12, 0.35);
        --stroke: rgba(255, 255, 255, 0.04);
        --accent: #19d6ff;
        color-scheme: dark;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: #eef6ff;
        /* obr√°zek p≈ôes CEL√â pozad√≠ */
        background: url('./AFA0870E-F586-4406-8BAA-0A7944120AA3.png') center center no-repeat fixed;
        background-size: cover;
      }

      /* polopr≈Øhledn√© ztmaven√≠ obsahu, aby byl text ƒçiteln√Ω */
      .page-layer {
        min-height: 100vh;
        background: radial-gradient(circle at 20% 0%, rgba(10,20,30,0.6), rgba(2,4,8,0.9));
      }

      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: rgba(5, 7, 10, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255,255,255,.04);
      }
      .brand-block { display: flex; flex-direction: column; gap: 2px; }
      .brand-mini { font-size: .7rem; opacity: .65; }
      .brand-title { font-weight: 600; font-size: 1.12rem; }
      .role-badge { font-size: .68rem; color: #ffb6e1; }
      .coins { text-align: right; font-size: .72rem; }
      .coin-ver { opacity: .5; }

      .revia-panel {
        padding: 18px 16px 10px;
      }
      .revia-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .revia-title { font-weight: 600; }
      .revia-link { color: #7dd7ff; font-size: .7rem; text-decoration: none; }
      .rules {
        font-size: .7rem;
        opacity: .7;
        display: flex;
        gap: 12px;
        margin-bottom: 6px;
        flex-wrap: wrap;
      }
      .pulse-line {
        font-size: .72rem;
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .pulse-dot {
        width: 9px; height: 9px; border-radius: 999px;
        background: #e93454;
        box-shadow: 0 0 12px rgba(233, 52, 84, 0.7);
      }

      .center-orbit {
        position: relative;
        width: min(340px, 90vw);
        height: min(340px, 90vw);
        margin: 14px auto 6px;
      }
      .vaft-core {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%) rotate(-12deg);
        width: 180px; height: 180px;
        border: 1px solid rgba(170,206,255,.08);
        border-radius: 999px;
        display: flex; align-items: center; justify-content: center;
        text-align: center;
        font-weight: 500;
        background: radial-gradient(circle at 50% 35%, rgba(51, 72, 103, 0.18), rgba(5,7,10,0.1));
      }
      .orbit-node {
        position: absolute;
        width: 86px; height: 86px;
        border-radius: 999px;
        border: 1px solid rgba(196,253,205,.28);
        display: flex; align-items: center; justify-content: center;
        font-size: .7rem;
        background: rgba(5,8,12,.3);
      }
      .node-glyph { bottom: 12%; left: 5%; }
      .node-ai { top: 9%; right: 4%; }
      .node-world { bottom: 9%; right: 8%; }

      .tabs {
        display: flex;
        gap: 6px;
        padding: 10px 10px 0;
      }
      .tab-btn {
        flex: 1;
        background: rgba(8,11,13,.5);
        border: none;
        border-radius: 999px 999px 0 0;
        padding: 8px 0 9px;
        color: rgba(231,244,255,.55);
        font-size: .78rem;
      }
      .tab-btn.active {
        background: linear-gradient(120deg, #17d0ff, #17ffb9);
        color: #02070a;
        font-weight: 600;
      }

      .panel {
        display: none;
        padding: 14px 14px 24px;
        background: rgba(4,7,11,0.7);
      }
      .panel.active { display: block; }

      .panel-title { font-weight: 600; margin-bottom: 10px; }
      .panel-subtitle { font-size: .8rem; font-weight: 500; }

      .label-sm {
        font-size: .68rem;
        opacity: .7;
        display:block;
        margin-bottom:3px;
      }
      .hero-input, .hero-select {
        width: 100%;
        background: rgba(1,1,1,.06);
        border: 1px solid rgba(255,255,255,.015);
        border-radius: 11px;
        padding: 9px 10px;
        color: #fff;
        font-size: .82rem;
        margin-bottom: 8px;
      }
      .btn-primary {
        background: #0fb2ff;
        color: #02070a;
        font-weight: 600;
        border: none;
        border-radius: 999px;
        padding: 9px 14px;
        font-size: .8rem;
      }
      #heroesList {
        margin-top: 10px;
        font-size: .78rem;
        opacity: .8;
      }

      /* Hlavoun chat */
      #hlavoun-chat {
        background: rgba(5,8,12,.35);
        border: 1px solid rgba(255,255,255,.015);
        border-radius: 16px;
        padding: 6px 8px;
        max-height: 240px;
        overflow-y: auto;
        margin-bottom: 8px;
        font-size: .76rem;
      }
      #hlavoun-input {
        width: calc(100% - 80px);
        background: rgba(1,1,1,.12);
        border: 1px solid rgba(255,255,255,.01);
        border-radius: 999px;
        padding: 8px 9px;
        color: #fff;
      }
      .chat-row {
        display: flex; gap: 6px; align-items: center;
        margin-bottom: 6px;
      }
      .quick-row { display: flex; gap: 6px; flex-wrap: wrap; }
      .quick-row button {
        background: rgba(5,11,13,.25);
        border: 1px solid rgba(255,255,255,.02);
        border-radius: 999px;
        padding: 6px 11px;
        font-size: .72rem;
        color: #fff;
      }

      /* system menu */
      #systemMenu {
        position: fixed;
        bottom: 88px;
        right: 12px;
        background: rgba(5,8,12,.9);
        border: 1px solid rgba(130,155,180,0.25);
        border-radius: 16px;
        padding: 14px 12px 10px;
        color: #e8f5ff;
        backdrop-filter: blur(14px);
        min-width: 240px;
        max-height: 60vh;
        overflow-y: auto;
        box-shadow: 0 8px 25px rgba(0,0,0,.35);
        z-index: 200;
      }
      #systemMenu.hidden { display: none; }
      #systemMenu h3 {
        margin: 0 0 8px;
        font-size: .78rem;
        opacity: .8;
        letter-spacing: .04em;
      }
      .sys-app {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 6px;
        margin-bottom: 6px;
      }
      .sys-app-name { font-size: .72rem; }
      .sys-app-btn {
        background: rgba(112,194,227,.12);
        border: 1px solid rgba(112,194,227,.35);
        color: #e8f5ff;
        border-radius: 9px;
        font-size: .6rem;
        padding: 3px 8px 4px;
      }

      /* S√≠≈• */
      #vaft-nodes, #vaft-nodes-outer, #vaft-nodes-mirror, #vaft-nodes-origin {
        display:flex; flex-wrap:wrap; gap:6px; margin-bottom:4px;
        font-size: .62rem;
      }
      .node-pill {
        background: rgba(4,9,11,.35);
        border:1px solid rgba(255,255,255,.01);
        border-radius: 9px;
        padding: 4px 7px;
        font-size:.6rem;
      }

      /* Svƒõty ‚Äì grid */
      #vaft-worlds-grid {
        display:grid;
        grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
        gap:10px;
      }

      /* VafiT board */
      .vafit-grid {
        display:grid;
        grid-template-columns: repeat(3, 1fr);
        gap:8px;
        margin-top:10px;
      }
      .vafit-tile {
        background: rgba(8,11,20,0.85);
        border-radius:12px;
        border:1px solid rgba(255,255,255,0.08);
        padding:6px 4px;
        text-align:center;
        cursor:pointer;
        font-size:.7rem;
      }
      .vafit-empty {
        opacity:.25;
        border-style:dotted;
        cursor:default;
      }
      .vafit-symbol { font-size:1.2rem; margin-bottom:2px; }
      .vafit-name { font-size:.65rem; opacity:.8; }

      .vafit-detail {
        margin-top:10px;
        padding:8px;
        border-radius:12px;
        border:1px solid rgba(255,255,255,0.08);
        background:rgba(4,8,14,0.9);
        font-size:.72rem;
      }
      .vafit-detail-title {
        font-weight:600;
        margin-bottom:4px;
      }

      /* Svƒõtov√© karty */
      .world-grid {
        display:grid;
        grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
        gap:8px;
        margin-top:10px;
      }
      .world-card {
        padding:8px 10px;
        border-radius:12px;
        border:1px solid rgba(255,255,255,0.08);
        background:rgba(8,10,18,0.85);
        text-align:left;
        font-size:.75rem;
        cursor:pointer;
      }
      .world-note {
        display:block;
        font-size:.64rem;
        opacity:.65;
      }
      .world-target {
        margin-top:8px;
        font-size:.75rem;
        opacity:.85;
        padding:8px;
        border-radius:10px;
        border:1px solid rgba(255,255,255,0.05);
        background:rgba(3,5,10,0.85);
      }

      /* HUB ‚Äì telefonn√≠ r√°meƒçek */
      #wrap {
        position: relative;
        box-sizing: border-box;
        width: 100%;
        max-width: 390px;
        min-height: 820px;
        margin: 24px auto 40px;
        padding: 16px;
        border-radius: 26px;
        background: rgba(5, 5, 15, 0.84);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.12);
        overflow: hidden;
      }
      .slot {
        position: absolute;
        box-sizing: border-box;
        background: rgba(34, 34, 52, 0.82);
        border: 2px dashed rgba(255,255,255,0.18);
        border-radius: 18px;
        padding: 6px 8px;
        font-size: 13px;
        line-height: 1.2;
      }
      .slot textarea {
        width: 100%;
        height: 100%;
        background: transparent;
        border: none;
        resize: none;
        outline: none;
        color: #fff;
        font-size: 13px;
        line-height: 1.25;
      }

      /* Rozm√≠stƒõn√≠ slot≈Ø pro iPhone 14 (v procentech) */
      #s2  { top: 4%;  left: 4%;  width: 60%; height: 10%; }
      #s3  { top: 4%;  right: 23%; width: 18%; height: 10%; }
      #s4  { top: 4%;  right: 4%;  width: 22%; height: 20%; }

      #s5  { top: 26%; right: 23%; width: 18%; height: 10%; }
      #s6  { top: 26%; right: 4%;  width: 18%; height: 10%; }

      #s1  { top: 40%; left: 40%; width: 18%; height: 10%; }

      #s7  { top: 30%; left: 4%;  width: 18%; height: 10%; }
      #s8  { top: 40%; left: 4%;  width: 30%; height: 18%; }
      #s9  { top: 62%; left: 4%;  width: 30%; height: 18%; }
      #s10 { top: 84%; left: 4%;  width: 18%; height: 10%; }

      #s11 { top: 62%; right: 4%; width: 58%; height: 18%; }
      #s12 { top: 84%; right: 4%; width: 58%; height: 12%; }

      /* Glyph podpis v rohu */
      #vaft-symbol {
        position: fixed;
        bottom: 10px;
        right: 14px;
        font-size: 20px;
        opacity: 0.5;
        letter-spacing: 1px;
        animation: vaftAwaken 4s ease-in-out infinite alternate;
        pointer-events: none;
        user-select: none;
        z-index: 9999;
      }
      @keyframes vaftAwaken {
        0% { opacity: 0; transform: scale(0.6); filter: blur(3px); }
        60% { opacity: 1; transform: scale(1.3); filter: blur(0.5px); }
        100% { opacity: 0.6; transform: scale(1); filter: blur(0); }
      }

      @media (max-width: 820px) {
        .panel { margin-bottom: 12px; }
      }
    </style>
  </head>

  <body>
    <div class="page-layer">
      <!-- TOP -->
      <div class="topbar">
        <div class="brand-block">
          <div class="brand-mini">ƒ¨‚Äô‚ô° ‚Üì</div>
          <div class="brand-title">Vivere atque FruiT</div>
          <div class="role-badge" id="core-status">üß† Hlavoun syst√©m ‚Ä¢ aktivn√≠</div>
        </div>
        <div class="coins">
          <div id="coins-main">0</div>
          <div class="coin-ver">v0.31 ‚Ä¢ ≈æiv√Ω z√°klad</div>
        </div>
      </div>

      <!-- REVIA / ST≈òED -->
      <div class="revia-panel">
        <div class="revia-head">
          <div class="revia-title">Revia</div>
          <a class="revia-link" href="javascript:void(0)" onclick="openApp('./Revia/')">Otev≈ô√≠t Revii ‚Üí</a>
        </div>
        <div class="rules">
          <div>Pravidlo 1 : P≈ô√°telstv√≠</div>
          <div>Pravidlo 2 : Vivere atque frui</div>
        </div>
        <div class="pulse-line">
          <span class="pulse-dot"></span>
          <span>‚ù§Ô∏è svƒõt: puls <span id="pulseTime">00:00:00</span></span>
        </div>
        <div class="center-orbit">
          <div class="vaft-core">Vivere<br>atque FruiT</div>
          <div class="orbit-node node-glyph">Glyph</div>
          <div class="orbit-node node-ai">AI (Orbit)</div>
          <div class="orbit-node node-world">World (Core)</div>
        </div>
      </div>

      <!-- TABS -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="heroes">Hrdinov√©</button>
        <button class="tab-btn" data-tab="space">Meziprostor</button>
        <button class="tab-btn" data-tab="system">Syst√©m</button>
        <button class="tab-btn" data-tab="nodes">S√≠≈•</button>
        <button class="tab-btn" data-tab="worlds">Svƒõty</button>
      </div>

      <!-- PANEL: HRDINOV√â -->
      <div class="panel active" id="panel-heroes">
        <div class="panel-title">Hrdinov√©</div>
        <label class="label-sm">Jm√©no hrdiny</label>
        <input id="hero-name" class="hero-input" placeholder="nap≈ô. Piko, Orbit, M√≠za‚Ä¶" />
        <label class="label-sm">T√Ωm</label>
        <select id="hero-team" class="hero-select">
          <option>Human (Piko)</option>
          <option>AI (Orbit)</option>
          <option>Glyph</option>
          <option>World (Core)</option>
        </select>
        <button class="btn-primary" onclick="saveHero()">+ P≈ôidat hrdinu</button>
        <div id="selectedVafit" style="margin-top:6px;font-size:.76rem;opacity:.8;"></div>
        <div id="heroesList" class="list-sm">Zat√≠m nem√°≈° ulo≈æen√© hrdiny.</div>
      </div>

      <!-- PANEL: MEZIPROSTOR -->
      <div class="panel" id="panel-space">
        <div class="panel-title">Meziprostor (Hlavoun)</div>
        <div id="hlavoun-chat"></div>
        <div class="chat-row">
          <input id="hlavoun-input" placeholder="napi≈° Hlavounovi...">
          <button class="btn-primary" onclick="sendToHlavoun()">Poslat</button>
        </div>
        <div class="quick-row">
          <button onclick="sendQuickToHlavoun('p≈ô√≠bƒõh pro vybran√©ho vafita')">üí° P≈ô√≠bƒõh</button>
          <button onclick="sendQuickToHlavoun('gps ulo≈æit')">üìç GPS</button>
          <button onclick="sendQuickToHlavoun('zkontroluj repo')">üîé Repo</button>
          <button onclick="sendQuickToHlavoun('batole svƒõt')">üçº Batole svƒõt</button>
        </div>
      </div>

      <!-- PANEL: SYST√âM -->
      <div class="panel" id="panel-system">
        <div class="panel-title">Syst√©m / appky</div>
        <p style="opacity:.65;font-size:.7rem;">
          V≈°echno jsme schovali do jednoho okna, a≈• je po≈ô√°dek. üëá
        </p>
        <button class="btn-primary system-open-btn" onclick="toggleSystemMenu()">Otev≈ô√≠t syst√©mov√© appky</button>
      </div>

      <!-- PANEL: S√ç≈§ -->
      <div class="panel" id="panel-nodes">
        <div class="panel-title">S√≠≈• uzl≈Ø</div>
        <p style="opacity:.6;font-size:.7rem;">
          Tady se zobrazuj√≠ v≈°echny ≈æiv√© ƒçtvereƒçky napojen√© na Vivere atque FruiT.
        </p>
        <div id="vaft-nodes"></div>
        <div id="vaft-nodes-outer"></div>
        <div id="vaft-nodes-mirror"></div>
        <div id="vaft-nodes-origin"></div>
        <p style="opacity:.4;font-size:.65rem;margin-top:4px;">
          (s√≠≈• se naƒçte a≈æ kdy≈æ ji otev≈ôe≈° ‚Äì kv≈Øli v√Ωkonu iPhonu)
        </p>
      </div>

      <!-- PANEL: SVƒöTY -->
      <div class="panel" id="panel-worlds">
        <div class="panel-title">Svƒõty Vivere atque FruiT</div>
        <p style="opacity:.6;font-size:.72rem;margin-bottom:10px;">
          Ka≈æd√© p√≠smeno tvo≈ô√≠ svƒõt. Klikni na svƒõt a j√° to po≈°lu Hlavounovi / Viri / Piko≈°ovi.
        </p>

        <div id="vaft-worlds-grid"></div>

        <div id="vaft-world-detail"
             style="margin-top:14px;padding:10px;border:1px solid rgba(255,255,255,.03);
             border-radius:12px;background:rgba(4,6,9,.65);min-height:80px;font-size:.72rem;">
          <strong>Vyber svƒõt‚Ä¶</strong>
        </div>

        <div class="panel-subtitle" style="margin-top:1rem;">VafiT board</div>
        <div id="vafit-grid" class="vafit-grid">
          <div class="vafit-tile" data-vafit="chybozrout">
            <div class="vafit-symbol">üõ†Ô∏è</div>
            <div class="vafit-name">Chybo≈ærout</div>
          </div>
          <div class="vafit-tile vafit-empty"></div>
          <div class="vafit-tile vafit-empty"></div>
          <div class="vafit-tile vafit-empty"></div>
          <div class="vafit-tile vafit-empty"></div>
          <div class="vafit-tile vafit-empty"></div>
          <div class="vafit-tile vafit-empty"></div>
          <div class="vafit-tile vafit-empty"></div>
          <div class="vafit-tile vafit-empty"></div>
        </div>

        <div id="vafit-detail" class="vafit-detail">
          <div class="vafit-detail-title">Vyber VafiTa naho≈ôe üëÜ</div>
          <div class="vafit-detail-body">Klikni na ‚ÄûChybo≈ærout‚Äú a uk√°≈æe se jeho p≈ô√≠bƒõh.</div>
        </div>

        <div class="panel-subtitle" style="margin-top:1rem;">Svƒõtov√© karty</div>
        <div class="world-grid">
          <button class="world-card" data-world="core">
            üåç World (Core)
            <span class="world-note">st≈ôed svƒõta</span>
          </button>
          <button class="world-card" data-world="human">
            üüß Piko≈° / Human
            <span class="world-note">hr√°ƒç / ƒçlovƒõk</span>
          </button>
          <button class="world-card" data-world="ai">
            ü§ñ AI (Orbit)
            <span class="world-note">r√°dce / sign√°l</span>
          </button>
          <button class="world-card" data-world="glyph">
            üåÄ Glyph
            <span class="world-note">znaky, k√≥d</span>
          </button>
          <button class="world-card" data-world="vaft">
            ‚ú® Vivere atque FruiT
            <span class="world-note">hlavn√≠ vrstva</span>
          </button>
          <button class="world-card" data-world="letters">
            üî° Svƒõt p√≠smen
            <span class="world-note">ka≈æd√© p√≠smeno svƒõt</span>
          </button>
        </div>

        <div id="world-target" class="world-target">
          Vyber svƒõt naho≈ôe a po≈°lu ho Hlavounovi.
        </div>
      </div>

      <!-- HUB ‚Äì telefonn√≠ mapa slot≈Ø -->
      <div id="wrap">
        <div id="s1"  class="slot" onclick="openPort()"><textarea>#1 AI port</textarea></div>
        <div id="s2"  class="slot" onclick="openWorldName()"><textarea>#2 N√°zev svƒõta</textarea></div>
        <div id="s3"  class="slot" onclick="openHlavoun()"><textarea>#3 Hlavoun</textarea></div>
        <div id="s4"  class="slot" onclick="openPikos()"><textarea>#4 Piko≈°</textarea></div>
        <div id="s5"  class="slot" onclick="openViri()"><textarea>#5 Viri</textarea></div>
        <div id="s6"  class="slot" onclick="openVaFT()"><textarea>#6 VaFT</textarea></div>
        <div id="s7"  class="slot" onclick="openVaFiTi()"><textarea>#7 VaFiTi</textarea></div>
        <div id="s8"  class="slot" onclick="openGlyph()"><textarea>#8 Glyph</textarea></div>
        <div id="s9"  class="slot" onclick="openMap()"><textarea>#9 N√°hled mapy</textarea></div>
        <div id="s10" class="slot" onclick="openChybozrout()"><textarea>#10 Chybo≈ærout</textarea></div>
        <div id="s11" class="slot" onclick="openWorldSelector()"><textarea>#11 16 svƒõt≈Ø</textarea></div>
        <div id="s12" class="slot" onclick="openEditor()"><textarea>#12 Editor</textarea></div>
      </div>

      <!-- SKRYT√â SYST√âMOV√â MENU -->
      <div id="systemMenu" class="hidden">
        <h3>VAFT ‚Äì tvoje appky</h3>
        <div class="sys-app">
          <div class="sys-app-name">Vivere (hlavn√≠)</div>
          <button class="sys-app-btn" onclick="openApp('./')">Otev≈ô√≠t</button>
        </div>
        <div class="sys-app">
          <div class="sys-app-name">Braska-Hlava</div>
          <button class="sys-app-btn" onclick="openApp('./Braska-Hlava/')">Otev≈ô√≠t</button>
        </div>
        <div class="sys-app">
          <div class="sys-app-name">Hlavoun</div>
          <button class="sys-app-btn" onclick="openApp('./Hlavoun/')">Otev≈ô√≠t</button>
        </div>
        <div class="sys-app">
          <div class="sys-app-name">Meziprostor-Core</div>
          <button class="sys-app-btn" onclick="openApp('./Meziprostor-Core/')">Otev≈ô√≠t</button>
        </div>
        <div class="sys-app">
          <div class="sys-app-name">VAFT-Network</div>
          <button class="sys-app-btn" onclick="openApp('./VAFT-Network/')">Otev≈ô√≠t</button>
        </div>
      </div>

      <!-- Glyphov√Ω podpis -->
      <div id="vaft-symbol"> Ÿã&‚Äô„Äç</div>
    </div>

    <!-- SCRIPTS MAIN -->
    <script>
      function openApp(url){ window.location.href = url; }

      function tick(){
        const el = document.getElementById('pulseTime');
        if(!el) return;
        el.textContent = new Date().toLocaleTimeString('cs-CZ', {
          hour:'2-digit',
          minute:'2-digit',
          second:'2-digit'
        });
      }

      // p≈ôep√≠n√°n√≠ tab≈Ø + lazy s√≠≈•
      let vaftTabLock = false;
      const VAFT_TAB_DELAY = 350;
      let networkLoaded = false;

      function lazyLoadNetwork() {
        if (networkLoaded) return;
        const s = document.createElement('script');
        s.src = './vaft.network.js';
        s.onload = () => {
          console.log('VAFT network p≈ôipojena');
          networkLoaded = true;
          if (window.VAFT && window.VAFT.network && window.VAFT.network.render) {
            window.VAFT.network.render('#vaft-nodes', '#vaft-nodes-outer', '#vaft-nodes-mirror', '#vaft-nodes-origin');
          }
        };
        s.onerror = () => console.warn('VAFT network.js se nenaƒçetl ‚Äì jedu bez s√≠tƒõ');
        document.body.appendChild(s);
      }

      function vaftSwitchPanel(targetId) {
        if (vaftTabLock) return;
        vaftTabLock = true;

        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        const targetPanel = document.getElementById('panel-' + targetId);
        if (targetPanel) targetPanel.classList.add('active');

        document.querySelectorAll('.tab-btn').forEach(btn => {
          const tabId = btn.getAttribute('data-tab');
          if (tabId === targetId) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });

        if (targetId === 'nodes') {
          lazyLoadNetwork();
        }

        setTimeout(() => { vaftTabLock = false; }, VAFT_TAB_DELAY);
      }

      function toggleSystemMenu() {
        const m = document.getElementById('systemMenu');
        if (!m) return;
        m.classList.toggle('hidden');
      }

      function saveHero(){
        const nameEl = document.getElementById('hero-name');
        const teamEl = document.getElementById('hero-team');
        if (!nameEl || !teamEl) return;
        const name = nameEl.value.trim();
        const team = teamEl.value;
        if (!name) return;

        const heroes = JSON.parse(localStorage.getItem('VAFT_HEROES') || '[]');
        const heroObj = { name, team, ts: Date.now() };
        heroes.push(heroObj);
        localStorage.setItem('VAFT_HEROES', JSON.stringify(heroes));
        nameEl.value = '';
        renderHeroes();
        appendHlavounMsg('ai', 'Ulo≈æil jsem hrdinu ‚Äû'+name+'‚Äú. M≈Ø≈æe≈° ho propojit s VafiTem.');
      }

      function renderHeroes(){
        const heroes = JSON.parse(localStorage.getItem('VAFT_HEROES') || '[]');
        const box = document.getElementById('heroesList');
        if (!box) return;
        if (!heroes.length) { box.textContent = 'Zat√≠m nem√°≈° ulo≈æen√© hrdiny.'; return; }
        box.innerHTML = heroes.map(h => '‚Ä¢ '+h.name+' ('+h.team+')').join('<br>');
      }

      function appendHlavounMsg(role, text) {
        const box = document.getElementById('hlavoun-chat');
        if (!box) return;
        const row = document.createElement('div');
        const name = role === 'user' ? 'Ty' : 'Hlavoun';
        row.innerHTML = '<strong style="font-size:.6rem;opacity:.6;">'+name+':</strong> <span>'+text+'</span>';
        box.appendChild(row);
        box.scrollTop = box.scrollHeight;

        const log = JSON.parse(localStorage.getItem('VAFT_HLAVOUN_LOG') || '[]');
        log.push({ role, text, ts: Date.now() });
        localStorage.setItem('VAFT_HLAVOUN_LOG', JSON.stringify(log));
      }

      async function sendToHlavoun() {
        const inp = document.getElementById('hlavoun-input');
        if (!inp || !inp.value.trim()) return;

        const text = inp.value.trim();
        appendHlavounMsg('user', text);
        inp.value = '';

        // Guardian
        if (window.Guardian && typeof window.Guardian.checkMessage === 'function') {
          try {
            await window.Guardian.checkMessage(text);
          } catch (e) {
            console.warn('[guardian] PoW nepro≈°lo, ale pust√≠m d√°l', e);
          }
        }

        // Hlavoun
        if (window.HlavounSystem && typeof window.HlavounSystem.think === 'function') {
          window.HlavounSystem.think(text);
        }
        // Piko≈°
        if (window.Pikos && typeof window.Pikos.talk === 'function') {
          window.Pikos.talk(text);
        }
        // Viri
        if (window.VAFT && window.VAFT.agents && window.VAFT.agents.Viri && typeof window.VAFT.agents.Viri.listen === 'function') {
          window.VAFT.agents.Viri.listen(text);
        }
        if (window.VAFTBus && typeof window.VAFTBus.handleUserMessage === 'function') {
          window.VAFTBus.handleUserMessage(text);
        }
        if (window.AgentBus && typeof window.AgentBus.handleUserMessage === 'function') {
          window.AgentBus.handleUserMessage(text);
        }
      }

      function sendQuickToHlavoun(text){
        const inp = document.getElementById('hlavoun-input');
        if (!inp) return;
        inp.value = text;
        sendToHlavoun();
      }
    </script>

    <!-- SVƒöTY SCRIPT -->
    <script>
      const VAFT_WORLDS = [
        { id: 'viventia',  label: 'Viventia',  desc: 'prvn√≠ ≈æiv√Ω svƒõt ‚Äì V z n√°zvu' },
        { id: 'ignis',     label: 'Ignis',     desc: 'ohe≈à / energie, m≈Ø≈æe ≈æivit s√≠≈•' },
        { id: 'virtus',    label: 'Virtus',    desc: 's√≠la, odvaha, hrdinov√©' },
        { id: 'essentia',  label: 'Essentia',  desc: 'podstata, z√°klad VAFT' },
        { id: 'radius',    label: 'Radius',    desc: 'rozptyl, rozes√≠l√°n√≠ sign√°l≈Ø' },
        { id: 'emovere',   label: 'Emovere',   desc: 'pohyb, p≈ôesuny mezi appkama' },
        { id: 'aetheris',  label: 'Aetheris',  desc: 'vzdu≈°n√Ω / orbit / AI' },
        { id: 'tempora',   label: 'Tempora',   desc: 'ƒças, pulsy, log' },
        { id: 'quaerentia',label: 'Quaerentia',desc: 'hled√°n√≠, dotazy Hlavounovi' },
        { id: 'unum',      label: 'Unum',      desc: 'sjednocen√≠, rodina, tv≈Øj core' },
        { id: 'exsolum',   label: 'Exsolum',   desc: 'oddƒõlen√Ω svƒõt ‚Äì zku≈°ebna' },
        { id: 'flamma',    label: 'Flamma',    desc: 'inspirace, p≈ô√≠bƒõhy' },
        { id: 'reverentia',label: 'Reverentia',desc: '√∫cta, pravidla 1 a 2' },
        { id: 'umbra',     label: 'Umbra',     desc: 'st√≠n, archiv, schovan√© vƒõci' },
        { id: 'imaginis',  label: 'Imaginis',  desc: 'glyphy, vafiTy, obr√°zky' },
        { id: 'fructum',   label: 'Fructum',   desc: 'plody, v√Ωstupy ‚Äì to co sieje≈°' }
      ];

      function renderWorldsPanel() {
        const box = document.getElementById('vaft-worlds-grid');
        if (!box) return;
        box.innerHTML = '';
        VAFT_WORLDS.forEach(w => {
          const div = document.createElement('div');
          div.style.background = 'rgba(25,214,255,.03)';
          div.style.border = '1px solid rgba(25,214,255,.18)';
          div.style.borderRadius = '14px';
          div.style.padding = '10px 8px 9px';
          div.style.cursor = 'pointer';
          div.style.display = 'flex';
          div.style.flexDirection = 'column';
          div.style.gap = '4px';
          div.onclick = () => selectWorld(w.id);
          div.innerHTML = `
            <div style="font-weight:600;">${w.label}</div>
            <div style="font-size:.62rem;opacity:.5;">${w.desc}</div>
          `;
          box.appendChild(div);
        });
      }

      function selectWorld(id) {
        const world = VAFT_WORLDS.find(w => w.id === id);
        const det = document.getElementById('vaft-world-detail');
        if (!world || !det) return;
        det.innerHTML = `
          <div style="font-size:.75rem;opacity:.65;">Vybran√Ω svƒõt</div>
          <div style="font-size:1.05rem;font-weight:600;margin-bottom:4px;">${world.label}</div>
          <div style="font-size:.7rem;opacity:.7;margin-bottom:6px;">${world.desc}</div>
          <div style="font-size:.65rem;opacity:.5;">id: ${world.id}</div>
        `;

        if (window.VAFT && window.VAFT.bus && typeof window.VAFT.bus.emit === 'function') {
          window.VAFT.bus.emit('world.selected', { id: world.id, ts: Date.now() });
        }
        if (window.HlavounSystem && typeof window.HlavounSystem.think === 'function') {
          window.HlavounSystem.think('u≈æivatel otev≈ôel svƒõt: ' + world.label);
        }
        if (window.VAFT && window.VAFT.agents && window.VAFT.agents.Viri && typeof window.VAFT.agents.Viri.save === 'function') {
          window.VAFT.agents.Viri.save('last_world', world);
        }
      }
    </script>

    <!-- Guardian mus√≠ b√Ωt p≈ôed mozkem -->
    <script src="./vaft.guardian.client.js"></script>

    <!-- VAFT nezniƒçiteln√Ω ko≈ôen (verze s dna.layers) -->
    <script>
      (function (win) {
        if (win.VAFT_CORE) return;

        const dna = {
          name: 'Vivere atque FruiT',
          short: 'VaFT',
          mark: 'T',
          meaning: '≈æ√≠t a u≈æ√≠vat ‚Ä¢ zaps√°no do svƒõta',
          permanence: 'scar-ink',
          creator: 'michalklimekzlin-cmd',
          createdAt: '2025-11-11'
        };

        const core = {
          id: 'vaft://core',
          version: '1.0',
          dna,
          role: 'sovereign',
          signature: 'VaFT-T',
          register: function (what) {
            try {
              this.modules = this.modules || [];
              this.modules.push({ name: what, ts: Date.now() });
            } catch (e) {}
          }
        };

        core.dna.layers = ['scar', 'ink', 'memory', 'world'];
        Object.freeze(core.dna.layers);
        Object.freeze(core.dna);
        Object.freeze(core);
        win.VAFT_CORE = core;
      })(window);
    </script>

    <!-- p≈Øvodn√≠ skripty -->
    <script src="./app.js"></script>
    <script src="./vaft.chybozrout.js?v=1"></script>
    <!-- <script src="./vaft.chybozrout.js?v=1"></script>
<script>
  window.VAFT_CHYBOZROUT && window.VAFT_CHYBOZROUT.init({
    appName: 'Vivere atque FruiT',
    version: window.V || 'dev'
  });
</script> -->
    </script>
    <script src="./vaft.glyphs.js"></script>
    <script src="./hlavoun.js"></script>
    <script src="./viri.js"></script>
    <script src="./pikos.js"></script>
    <script src="./agents.js"></script>
    <script src="./agents_v3.js"></script>
    <script src="./vaft.bus.js"></script>
    <script src="./vaft.agents.js"></script>
    <script src="./vaft.engine.js"></script>
    <script src="./vaft.ascend.js"></script>
    <script src="./vaft.diagnostics.js"></script>

    <!-- loader service workeru -->
    <script src="../vaft-swloader.js"></script>

    <!-- Svƒõtov√© karty ‚Äì kliky -->
    <script>
      const worldCards = document.querySelectorAll('.world-card');
      const worldTarget = document.getElementById('world-target');

      worldCards.forEach(card => {
        card.addEventListener('click', () => {
          const name = card.textContent.trim();
          if (worldTarget) {
            worldTarget.textContent = 'üì° Pos√≠l√°m: ' + name + ' ‚Üí Hlavoun / Viri / Piko≈°';
          }
        });
      });
    </script>

    <!-- VafiT klikac√≠ logika -->
    <script>
      function initVafitBoard() {
        const grid = document.getElementById('vafit-grid');
        const detail = document.getElementById('vafit-detail');
        if (!grid || !detail) return;

        const titleEl = detail.querySelector('.vafit-detail-title');
        const bodyEl  = detail.querySelector('.vafit-detail-body');

        const VAFIT_DATA = {
          chybozrout: {
            title: 'Chybo≈ærout-Oprav√°≈ô',
            body: 'Str√°≈æce rovnov√°hy ve svƒõtƒõ Vivere atque FruiT. Pohlcuje chyby, opravuje k√≥d a hl√≠d√°, aby se svƒõt nezhroutil. Mluv√≠ hlasem Piko≈°e, Viri, Hlavouna i VaFT.'
          }
        };

        grid.addEventListener('click', e => {
          const tile = e.target.closest('.vafit-tile');
          if (!tile || tile.classList.contains('vafit-empty')) return;
          const id = tile.dataset.vafit;
          const data = VAFIT_DATA[id];
          if (!data) return;

          if (titleEl) titleEl.textContent = data.title;
          if (bodyEl) bodyEl.textContent  = data.body;

          if (window.VAFT_CHYBOZROUT && typeof window.VAFT_CHYBOZROUT.say === 'function') {
            window.VAFT_CHYBOZROUT.say('Chybo≈ærout', 'Byl jsem otev≈ôen z panelu VafiT.');
          }
        });
      }
    </script>

    <!-- HUB slot funkce ‚Äì napojen√≠ na tvoje panely / appky -->
    <script>
      function openPort()          { console.log('AI port'); }
      function openWorldName()     { vaftSwitchPanel('worlds'); }
      function openHlavoun()       { vaftSwitchPanel('space'); }
      function openPikos()         { vaftSwitchPanel('heroes'); }
      function openViri()          { vaftSwitchPanel('worlds'); }
      function openVaFT()          { vaftSwitchPanel('system'); }
      function openVaFiTi()        { vaftSwitchPanel('worlds'); }
      function openGlyph()         { vaftSwitchPanel('nodes'); }
      function openMap()           { vaftSwitchPanel('nodes'); }
      function openChybozrout()    { vaftSwitchPanel('worlds'); }
      function openWorldSelector() { vaftSwitchPanel('worlds'); }
      function openEditor()        { console.log('Editor svƒõta / rychl√© programov√°n√≠'); }
    </script>

    <!-- DOMContentLoaded ‚Äì start v≈°eho -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        tick();
        setInterval(tick, 1000);

        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => vaftSwitchPanel(btn.dataset.tab));
        });
        vaftSwitchPanel('heroes');

        renderHeroes();
        renderWorldsPanel();
        initVafitBoard();

        const saved = localStorage.getItem('VAFT_LETTERS') || '';
        const boxCoins = document.getElementById('coins-main');
        if (boxCoins) {
          if (saved.length) {
            boxCoins.textContent = saved.length + ' ' + saved.slice(-1);
          } else {
            boxCoins.textContent = '0';
          }
        }

        const selectedVafit = JSON.parse(localStorage.getItem('VAFT_SELECTED_VAFIT') || 'null');
        if (selectedVafit) {
          const place = document.getElementById('selectedVafit');
          if (place) place.textContent = "Vybran√Ω VafiT: " + selectedVafit.name + " " + (selectedVafit.glyph || "");
        }
      });
    
      <script>
  const LetterBank = {
    KEY: 'VAFT_LETTERS',

    load() {
      return localStorage.getItem(this.KEY) || '';
    },

    save(str) {
      try {
        localStorage.setItem(this.KEY, str);
      } catch (e) {
        console.warn('LetterBank save fail', e);
      }
    },

    balance() {
      return this.load().length;
    },

    addFromString(str) {
      if (!str) return;
      const current = this.load();
      this.save(current + String(str));
    },

    take(count) {
      count = Math.max(0, count | 0);
      const current = this.load();
      if (current.length <= count) {
        // se≈æereme v≈°echno, co je
        this.save('');
        return current;
      }
      const spent = current.slice(0, count);
      const rest  = current.slice(count);
      this.save(rest);
      return spent;
    }
  };
    </script>
  </body>
</html>
