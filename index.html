<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Batolesvět 3D • v0.34 PWA</title>
  <meta name="color-scheme" content="dark light" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon512.png">
  <style>
    html,body{margin:0;height:100%;background:#000;color:#cfe;
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;overflow:hidden}
    #top{position:fixed;left:12px;top:12px;right:12px;display:flex;gap:10px;align-items:center;
      padding:8px 12px;background:rgba(10,12,16,.72);backdrop-filter:saturate(120%) blur(8px);
      border:1px solid #223;border-radius:.6rem;z-index:10}
    .btn{padding:8px 14px;border-radius:.7rem;border:1px solid #334;background:#10141a;
      color:#cfe;font-weight:600;cursor:pointer}
    .btn:hover{background:#151a22}
    #ui{position:fixed;inset:auto 12px 12px 12px;display:flex;gap:8px;align-items:flex-end;z-index:10}
    #prog{flex:1;min-height:64px;max-height:35vh;background:#0a0e14;border:1px solid #223;
      color:#bfe;border-radius:.6rem;padding:10px;font-family:ui-monospace,Consolas,Monaco,monospace}
    #hint{opacity:.8}
    canvas{display:block;width:100vw;height:100vh}

    /* D-pad (volitelný) */
    #hud-dpad{
      position:fixed;left:12px;bottom:12px;display:grid;
      grid-template-columns:56px 56px 56px;grid-template-rows:56px 56px 56px;
      gap:8px;user-select:none;z-index:20;pointer-events:auto
    }
    #hud-dpad button{
      padding:8px 0;border:1px solid #334;background:#10141a;color:#cfe;
      border-radius:.7rem;font-weight:700
    }
    #hud-dpad .spacer{opacity:0;pointer-events:none}
  </style>
</head>
<body>
  <div id="top">
    <strong>Vivere atque FruiT • 3D</strong>
    <span id="hint">1) Prostor → 2) Postavy • otáčej prstem/myší</span>
    <div style="margin-left:auto;display:flex;gap:8px">
      <button class="btn" id="spaceBtn">Prostor</button>
      <button class="btn" id="avatarsBtn">Postavy</button>
      <button class="btn" id="runBtn">Spustit</button>
      <button class="btn" id="clearBtn">Vyčistit</button>
      <button class="btn" id="installBtn" hidden>Instalovat</button>
    </div>
  </div>

  <div id="ui">
    <textarea id="prog" spellcheck="false">\{*(•.)(.•)*}//  \[*(•.)(.•)*]//</textarea>
  </div>

  <canvas id="c" aria-label="Batolesvět 3D"></canvas>

  <!-- On-screen D-pad (volitelný) -->
  <div id="hud-dpad" aria-label="D-pad">
    <div class="spacer"></div><button data-dir="up">▲</button><div class="spacer"></div>
    <button data-dir="left">◀</button><div class="spacer"></div><button data-dir="right">▶</button>
    <div class="spacer"></div><button data-dir="down">▼</button><div class="spacer"></div>
  </div>

  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

  <script>window.V=34;</script>
  <script src="main.js?v=34"></script>

  <script>
    // Registrace SW (offline)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }

    // „Instalovat“ tlačítko (PWA prompt)
    let deferredPrompt=null;
    const btn=document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt',(e)=>{
      e.preventDefault(); deferredPrompt=e; btn.hidden=false;
    });
    btn.addEventListener('click', async()=>{
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice; deferredPrompt=null; btn.hidden=true;
    });
  </script>
</body>
</html>