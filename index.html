<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Batolesvƒõt ‚Ä¢ VaFT (≈æiv√© j√°dro)</title>
  <style>
    html,body{margin:0;height:100%;background:#000;color:#cfe;font:16px/1.5 system-ui,-apple-system,sans-serif;overflow:hidden}
    canvas{width:100%;height:100%;display:block}
    .btn{position:fixed;padding:8px 14px;border-radius:.7rem;border:1px solid #334;background:rgba(28,30,36,.85);color:#cbe;font-weight:600;backdrop-filter:blur(8px) saturate(120%);transition:.25s;z-index:20}
    .btn:hover{background:rgba(50,52,60,.92)}
    #btnTopLeft{top:16px;left:16px} #btnTopRight{top:16px;right:16px}
    #btnBottomLeft{bottom:16px;left:16px} #btnBottomRight{bottom:16px;right:16px}
    #worldLabel{position:fixed;left:0;right:0;bottom:64px;text-align:center;color:#9ff;opacity:.9;z-index:15}
    #hudLog{
      position:fixed;left:50%;transform:translateX(-50%);
      bottom:92px;max-width:92vw;background:rgba(20,22,26,.82);color:#cfe;
      border:1px solid #2d3a40;border-radius:10px;padding:10px 14px;
      font:13px/1.4 system-ui,-apple-system,sans-serif;box-shadow:0 8px 30px rgba(0,0,0,.45);backdrop-filter:blur(8px);z-index:30
    }
    #advice{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;padding:8px 12px;border-radius:.7rem;border:1px solid #355;background:rgba(12,18,24,.9);color:#cff;font-weight:600;opacity:0;transition:.3s;pointer-events:none;z-index:40}
    #err{position:fixed;left:10px;bottom:10px;max-width:88vw;max-height:40vh;overflow:auto;background:rgba(10,10,10,.9);color:#f88;border:1px solid #500;border-radius:8px;padding:8px 10px;font:12px/1.35 ui-monospace,Menlo,Consolas;z-index:9999;display:none;white-space:pre-wrap}
  </style>
</head>
<body>
  <!-- rohov√© odznaky -->
  <div id="btnTopLeft" class="btn">Batolesvƒõt</div>
  <div id="btnTopRight" class="btn">Glyph</div>
  <div id="btnBottomLeft" class="btn">Pedrovci</div>
  <div id="btnBottomRight" class="btn">AI</div>

  <div id="worldLabel">Svƒõt: Michal Klimek</div>

  <!-- vrstvy -->
  <canvas id="canvasDoor" style="position:fixed;inset:0;z-index:0;pointer-events:none;"></canvas>
  <canvas id="canvasVaFT" style="position:fixed;inset:0;z-index:1;"></canvas>
  <canvas id="canvasAura" style="position:fixed;inset:0;z-index:2;pointer-events:none;"></canvas>

  <div id="hudLog">üß≠ f√°ze: ‚Ä¶<br>üß™ mix ‚Üí B:0% ‚Ä¢ G:0% ‚Ä¢ AI:0% ‚Ä¢ P:0%</div>
  <div id="advice">‚Ä¶</div>
  <pre id="err"></pre>

  <script>
    const $ = s => document.querySelector(s);
    const logErr = (msg)=>{
      const el=$('#err'); el.style.display='block'; el.textContent += (msg+'\n');
    };
    window.addEventListener('error', e=>logErr(`‚ùå ${e.message} @ ${e.filename?.split('/').pop?.()}:${e.lineno||''}`));
    window.addEventListener('unhandledrejection', e=>logErr('‚ùå Promise: '+(e.reason?.message||e.reason||'unknown')));
  </script>

  <!-- ‚úÖ hlavn√≠ modul -->
  <script type="module">
    /* CORE */
    import { VaFTXP }            from './VaFT.experience.js?v=2';
    import { startVaFTForm }     from './VaFT.form.js?v=2';
    import { buildInventory }    from './VaFT.inventory.js?v=2';
    import { initVaFTLearning }  from './VaFT.learning.js?v=2';
    import { startVaFTDoor }     from './VaFT.door.js?v=2';
    import { startVaFTAura }     from './VaFT.aura.js?v=2';

    /* EXTRA MODULY */
    import { initVaFTGuardian }  from './VaFT.guardian.js?v=2';
    import { initVaFTMind }      from './VaFT.mind.js?v=2';
    import { initVaFTSkills }    from './VaFT.skills.js?v=2';

    /* OSTATN√ç */
    import { initMap }           from './map.logic.js?v=2';
    import './events.core.js?v=2';
    import { mountMentorBadges } from './badges.js?v=2';
    mountMentorBadges('./data/members.json?v=2');

    /* === START === */
    const door = startVaFTDoor(document.getElementById('canvasDoor'));
    const aura = startVaFTAura(document.getElementById('canvasAura'));
    const cv   = document.getElementById('canvasVaFT');

    const xp   = new VaFTXP();
    const vaft = startVaFTForm(cv);
    const learning = initVaFTLearning(xp);

    const guardian = initVaFTGuardian(xp);
    const mind     = initVaFTMind(xp);
    const skills   = initVaFTSkills(xp);

    const hud = document.getElementById('hudLog');
    const advice = document.getElementById('advice');

    const showAdvice = (t)=>{
      advice.textContent = t; advice.style.opacity = 1;
      clearTimeout(showAdvice._t);
      showAdvice._t = setTimeout(()=>advice.style.opacity=0,2000);
    };

    // rohy ‚Üí EVENTS
    const L = id => document.getElementById(id);
    L('btnTopLeft').onclick     = () => { window.EVENTS.ground(); window.EVENTS.voice({team:'batolesvet',text:'puls pamƒõti',weight:+0.8}); showAdvice('üå± Klid je s√≠la.'); };
    L('btnTopRight').onclick    = () => { window.EVENTS.voice({team:'glyph',text:'‚Üí ‚òº',weight:+0.6}); window.EVENTS.vision({kind:'symbol',truth:1}); showAdvice('‚ú® Slova & symboly.'); };
    L('btnBottomLeft').onclick  = () => { window.EVENTS.voice({team:'pedrovci',text:'c√≠t√≠m zmƒõnu',weight:+0.6}); window.EVENTS.mood({calm:+0.05}); showAdvice('‚ù§Ô∏è D≈Øvƒõ≈ôuj pocitu.'); };
    L('btnBottomRight').onclick = () => { window.EVENTS.voice({team:'ai',text:'anal√Ωza: v√Ωchod',weight:+0.7}); window.EVENTS.vision({kind:'path',truth:1}); showAdvice('üß© Logika vp≈ôed.'); };

    // HUD helper
    function paintHUD(s){
      const pct = k=>Math.round(100*Math.max(0,Math.min(1,s.mix[k]/3)));
      hud.innerHTML = `üß≠ f√°ze: ${s.label}<br>üß™ mix ‚Üí B:${pct('B')}% ‚Ä¢ G:${pct('G')}% ‚Ä¢ AI:${pct('AI')}% ‚Ä¢ P:${pct('P')}%<br>‚Ä¢ Guardian calm: ${guardian.calm?.toFixed?.(2) ?? '‚Äî'}`;
    }

    // hlavn√≠ smyƒçka
    let lastLabel='';
    function loop(){
      xp.tick();
      learning.tick?.();
      const s = xp.getState();
      guardian.tick();
      mind.reflect();
      skills.decay();
      vaft.setMix(s.mix);
      vaft.step();
      aura?.setMix?.(s.mix);
      aura?.tick?.();
      door?.tick?.(s);
      paintHUD(s);
      if (s.label !== lastLabel) {
        lastLabel = s.label;
        buildInventory(s).then(inv => initMap({ canvas: cv, inventory: inv }));
      }
      requestAnimationFrame(loop);
    }
    loop();

    // simulace ≈æivota
    let t=0;
    setInterval(()=>{
      xp.add({team:'batolesvet', value:Math.abs(Math.sin(t*.33))*2});
      xp.add({team:'glyph',      value:Math.abs(Math.sin(t*.51))*2});
      xp.add({team:'ai',         value:Math.abs(Math.sin(t*.77))*2});
      xp.add({team:'pedrovci',   value:Math.abs(Math.cos(t*.41))*2});
      if (Math.sin(t*.5)>0.9) skills.gain?.('vn√≠mavost', 0.02);
      t+=.055;
    },220);
  </script>
</body>
</html>