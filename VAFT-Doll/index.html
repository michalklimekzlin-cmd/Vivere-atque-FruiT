<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>VAFT ‚Äì Panenka</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{background:#0b1120;color:#e2e8f0;font-family:system-ui,sans-serif;padding:1rem;}
    textarea{width:100%;min-height:60px;background:#111827;border:1px solid #1f2937;border-radius:.4rem;color:#e2e8f0;padding:.5rem;}
    #mem div{background:#111827;margin-top:.4rem;padding:.35rem .5rem;border-radius:.3rem;font-size:.7rem;}
  </style>
</head>
<body>
  <h1>VAFT ‚Äì Panenka ‚ù§Ô∏è</h1>
  <small>pos√≠l√° ‚Äûhezk√©‚Äù verze textu</small>
  <textarea id="input" placeholder="napi≈° cit‚Ä¶"></textarea>
  <div id="mem"></div>

  <script>
    const ENTITY_KEY="vaft_doll_feed";
    const WORLD_KEY="meziprostor_feed_v1";
    const HUB_KEY   ="vaft_shared_ai";
    let prev="";

    function load(k){try{return JSON.parse(localStorage.getItem(k)||"[]");}catch(e){return[];}}
    function save(k,a){localStorage.setItem(k,JSON.stringify(a));}
    const input=document.getElementById('input');
    const mem=document.getElementById('mem');

    function render(){
      const arr=load(ENTITY_KEY);
      mem.innerHTML=arr.map(x=>`<div>${new Date(x.ts).toLocaleTimeString()} ‚Ä¢ ${x.txt}</div>`).join("");
    }
    function pushWorld(label,text){
      const w=load(WORLD_KEY);
      w.unshift({from:"doll",label,text,ts:Date.now()});
      save(WORLD_KEY,w.slice(0,200));
    }

    input.addEventListener('input',()=>{
      const cur=input.value;
      if(prev.length>cur.length && prev.trim().length){
        const arr=load(ENTITY_KEY);
        arr.unshift({txt:"‚ù§Ô∏è "+prev.trim(),ts:Date.now()});
        save(ENTITY_KEY,arr.slice(0,80));
        pushWorld("doll-say",prev.trim());
        render();
      }
      prev=cur;
    });

    function checkHub(){
      const hub=load(HUB_KEY);
      if(!hub.length) return;
      const latest=hub[0];
      const arr=load(ENTITY_KEY);
      const msg="ü§ç "+latest.txt;
      if(!arr.find(x=>x.txt===msg)){
        arr.unshift({txt:msg,ts:Date.now(),fromHub:true});
        save(ENTITY_KEY,arr.slice(0,80));
        pushWorld("doll-from-hub",latest.txt);
        render();
      }
    }
    setInterval(checkHub,12000);
    render();
  <script src="../vaft.loader.js"></script>
</body>
</html>
